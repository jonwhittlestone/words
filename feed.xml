<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.0.0">Jekyll</generator><link href="https://words.howapped.com/feed.xml" rel="self" type="application/atom+xml" /><link href="https://words.howapped.com/" rel="alternate" type="text/html" /><updated>2020-06-02T08:27:41-05:00</updated><id>https://words.howapped.com/feed.xml</id><title type="html">howapped words</title><subtitle>Learnings and updates from the Howapped labs.</subtitle><entry><title type="html">Scheduled Severless Switch On</title><link href="https://words.howapped.com/aws%20lambda/automation/python/2020/06/01/serverless-scheduled-tasks.html" rel="alternate" type="text/html" title="Scheduled Severless Switch On" /><published>2020-06-01T00:00:00-05:00</published><updated>2020-06-01T00:00:00-05:00</updated><id>https://words.howapped.com/aws%20lambda/automation/python/2020/06/01/serverless-scheduled-tasks</id><content type="html" xml:base="https://words.howapped.com/aws%20lambda/automation/python/2020/06/01/serverless-scheduled-tasks.html">&lt;!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2020-06-01-serverless-scheduled-tasks.ipynb
--&gt;

&lt;div class=&quot;container&quot; id=&quot;notebook-container&quot;&gt;
        
    
    
&lt;div class=&quot;cell border-box-sizing code_cell rendered&quot;&gt;

&lt;/div&gt;
    

&lt;div class=&quot;cell border-box-sizing text_cell rendered&quot;&gt;&lt;div class=&quot;inner_cell&quot;&gt;
&lt;div class=&quot;text_cell_render border-box-sizing rendered_html&quot;&gt;
&lt;h1 id=&quot;The-Problem&quot;&gt;The Problem&lt;a class=&quot;anchor-link&quot; href=&quot;#The-Problem&quot;&gt; &lt;/a&gt;&lt;/h1&gt;&lt;p&gt;As part of the Covid-19 effort, Digital Ocean donated some free credit to us to work on a local food delivery scheme.&lt;/p&gt;
&lt;p&gt;To make that credit go as far as possible and to minimise power consumption, we'd like to power up and down the servers according to a schedule.&lt;/p&gt;
&lt;h1 id=&quot;The-Solution&quot;&gt;The Solution&lt;a class=&quot;anchor-link&quot; href=&quot;#The-Solution&quot;&gt; &lt;/a&gt;&lt;/h1&gt;&lt;p&gt;Esimated cost saving...&lt;/p&gt;
&lt;p&gt;Here's how to do that with AWS Lambda, with cloudfront events. We iterate on that to use the Serverless Framework.&lt;/p&gt;
&lt;h2 id=&quot;Prerequisites&quot;&gt;Prerequisites&lt;a class=&quot;anchor-link&quot; href=&quot;#Prerequisites&quot;&gt; &lt;/a&gt;&lt;/h2&gt;&lt;p&gt;To follow along, there is a bit of set up involved to launch a Droplet that you can inspect with SSH if you need.&lt;/p&gt;
&lt;p&gt;You will need to:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;.. have &lt;code&gt;jq&lt;/code&gt; installed to format JSON responses&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://stedolan.github.io/jq/download/&quot;&gt;Download JQ&lt;/a&gt; for your OS&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;.. &lt;a href=&quot;https://www.digitalocean.com/docs/apis-clis/api/&quot;&gt;generate&lt;/a&gt; an access token so you can use the Digital Ocean API.&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;.. add the access token to your environment&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;  $ export DIGITAL_OCEAN_ACCESS_TOKEN=[your_digital_ocean_token]&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;.. have a &lt;a href=&quot;https://www.digitalocean.com/docs/droplets/quickstart/#create-droplets&quot;&gt;running Digital Ocean Droplet&lt;/a&gt; with Docker installed.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;If you need to create one, use the following &lt;a href=&quot;https://developers.digitalocean.com/documentation/v2/#create-a-new-droplet&quot;&gt;API operation&lt;/a&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;  $ curl -X POST \
  -H 'Content-Type: application/json' \
  -H 'Authorization: Bearer '$DIGITAL_OCEAN_ACCESS_TOKEN'' \
  -d '{&quot;name&quot;:&quot;scheduled-serverless&quot;,&quot;region&quot;:&quot;lon1&quot;,&quot;size&quot;:&quot;s-2vcpu-4gb&quot;,&quot;image&quot;:&quot;docker-18-04&quot;}' \
  &quot;https://api.digitalocean.com/v2/droplets&quot;&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;.. &lt;a href=&quot;https://8gwifi.org/sshfunctions.jsp&quot;&gt;generate&lt;/a&gt; and add the private key to your droplet. When generating, Select: &lt;code&gt;RSA&lt;/code&gt; and &lt;code&gt;4096&lt;/code&gt; and leave &lt;code&gt;Passphrase&lt;/code&gt; blank. You may use the following API operation.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;.. add the public key to your environment&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;cell border-box-sizing text_cell rendered&quot;&gt;&lt;div class=&quot;inner_cell&quot;&gt;
&lt;div class=&quot;text_cell_render border-box-sizing rendered_html&quot;&gt;
&lt;h2 id=&quot;Shutdown-a-Droplet-with-CURL&quot;&gt;Shutdown a Droplet with CURL&lt;a class=&quot;anchor-link&quot; href=&quot;#Shutdown-a-Droplet-with-CURL&quot;&gt; &lt;/a&gt;&lt;/h2&gt;&lt;p&gt;Assuming, your account only has one Digital Ocean droplet, the following CURL statement shows &lt;code&gt;active&lt;/code&gt; status and the ID&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ curl \
    -H 'Content-Type: application/json' \
    -H 'Authorization: Bearer '$DIGITAL_OCEAN_ACCESS_TOKEN'' \
    &quot;https://api.digitalocean.com/v2/droplets?name=scheduled-serverless&quot; | jq '.droplets[0].status, .droplets[1].id'
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  4137    0  4137    0     0   7925      0 --:--:-- --:--:-- --:--:--  7940
&quot;active&quot;
194534673



&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Issuing the following &lt;a href=&quot;https://developers.digitalocean.com/documentation/v2/#shutdown-a-droplet&quot;&gt;CURL will&lt;/a&gt; shut it down.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;curl -X POST \
-H 'Content-Type: application/json' \
-H 'Authorization: Bearer '$DIGITAL_OCEAN_ACCESS_TOKEN'' \
-d '{&quot;type&quot;:&quot;shutdown&quot;}' \
&quot;https://api.digitalocean.com/v2/droplets/194534673/actions&quot;


&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;We can then verify  the droplet has been powered down by reissuing the previous command from above. to show the 'active' status.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;...
&quot;off&quot;
194534673&lt;/code&gt;&lt;/pre&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;cell border-box-sizing text_cell rendered&quot;&gt;&lt;div class=&quot;inner_cell&quot;&gt;
&lt;div class=&quot;text_cell_render border-box-sizing rendered_html&quot;&gt;
&lt;h2 id=&quot;Power-on-a-Droplet-with-CURL&quot;&gt;Power on a Droplet with CURL&lt;a class=&quot;anchor-link&quot; href=&quot;#Power-on-a-Droplet-with-CURL&quot;&gt; &lt;/a&gt;&lt;/h2&gt;&lt;p&gt;The action for powering on follows the same convention.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ curl -X POST \
    -H 'Content-Type: application/json' \
    -H 'Authorization: Bearer '$DIGITAL_OCEAN_ACCESS_TOKEN'' \
    -d '{&quot;type&quot;:&quot;power_on&quot;}' \
    &quot;https://api.digitalocean.com/v2/droplets/194534673/actions&quot;


&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;As befo&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;cell border-box-sizing text_cell rendered&quot;&gt;&lt;div class=&quot;inner_cell&quot;&gt;
&lt;div class=&quot;text_cell_render border-box-sizing rendered_html&quot;&gt;
&lt;h2 id=&quot;Requests-scripts-in-AWS-Lambda&quot;&gt;Requests scripts in AWS Lambda&lt;a class=&quot;anchor-link&quot; href=&quot;#Requests-scripts-in-AWS-Lambda&quot;&gt; &lt;/a&gt;&lt;/h2&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;cell border-box-sizing text_cell rendered&quot;&gt;&lt;div class=&quot;inner_cell&quot;&gt;
&lt;div class=&quot;text_cell_render border-box-sizing rendered_html&quot;&gt;
&lt;h2 id=&quot;Schedule-the-scripts-with-Cloudwatch-events&quot;&gt;Schedule the scripts with Cloudwatch events&lt;a class=&quot;anchor-link&quot; href=&quot;#Schedule-the-scripts-with-Cloudwatch-events&quot;&gt; &lt;/a&gt;&lt;/h2&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;cell border-box-sizing text_cell rendered&quot;&gt;&lt;div class=&quot;inner_cell&quot;&gt;
&lt;div class=&quot;text_cell_render border-box-sizing rendered_html&quot;&gt;
&lt;h2 id=&quot;Serverless-framework&quot;&gt;Serverless framework&lt;a class=&quot;anchor-link&quot; href=&quot;#Serverless-framework&quot;&gt; &lt;/a&gt;&lt;/h2&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class=&quot;cell border-box-sizing text_cell rendered&quot;&gt;&lt;div class=&quot;inner_cell&quot;&gt;
&lt;div class=&quot;text_cell_render border-box-sizing rendered_html&quot;&gt;
&lt;h2 id=&quot;Team-notifications-with-Slack&quot;&gt;Team notifications with Slack&lt;a class=&quot;anchor-link&quot; href=&quot;#Team-notifications-with-Slack&quot;&gt; &lt;/a&gt;&lt;/h2&gt;&lt;p&gt;As part of what's become known as 'Chatops', it's useful to update team members and stakeholders about the status of the server.&lt;/p&gt;
&lt;p&gt;There are a variety of messaging platforms that have APIs such as Telegram or even SMS, but Slack has become one of the most popular.&lt;/p&gt;

&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;</content><author><name></name></author><summary type="html"></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://words.howapped.com/images/chart-preview.png" /><media:content medium="image" url="https://words.howapped.com/images/chart-preview.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry></feed>