---
keywords: fastai
description: Using Python SDK with boto3 to create a serverless endpoint with AWS Lambda and AWS API Gateway.
title: hello world serverless microservice
toc: true 
badges: false
comments: false
categories: [AWS Lambda,boto3,python, AWS API Gateway]
image: http://i.imgur.com/C2bPqfo.png
show_image: true
hide: false
nb_path: _notebooks/2020-07-01-serverless-endpoint-with-aws-lambda-api-gateway-and-boto3.ipynb
layout: notebook
---

<!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2020-07-01-serverless-endpoint-with-aws-lambda-api-gateway-and-boto3.ipynb
-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Problem">Problem<a class="anchor-link" href="#Problem"> </a></h1><p>We've been asked for an API that will work at web scale and be cost effective. A serverless API is perfect for this.</p>
<p>What are the constituent parts needed to start working with the AWS SDK with Python and steps needed to write and execute a serverless script with AWS Lambda. How can this script be invoked by an HTTP endpoint?</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Solution">Solution<a class="anchor-link" href="#Solution"> </a></h1><p>The companion repo consists utility code for deploying the lambda with <a href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/lambda.html#lambda">boto3</a> as well as detail on the AWS API Gateway service that provides an endpoint to invoke the serverless function.</p>
<p>This is the end product; A serverless endpoint.</p>
<p><img src="http://i.imgur.com/Ql676IX.png" alt="End product - a simple serverless endpoint"></p>
<p>The <a href="https://github.com/jonwhittlestone/lambdapi">code can be found on Github.</a>.</p>
<p>Once cloned, install dependencies, set your AWS account ID as an environment variable and run it.</p>

<pre><code>(venv) (base) $ python src/main.py 

✅ Remove existing named lambda/api
✅ Create the lambda
✅ Deploy the lambda
✅ Remove any existing API
✅ Create API
✅ Deploy API
✅ Test API
SERVERLESS ENDPOINT RESPONSE from https://qvaik2un06.execute-api.eu-west-2.amazonaws.com/hello-world : 
b'{"querystring_params:": {}, "err": null, "message": "Hello Serverless World"}'</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Setup:-Creating-the-Lambda-function-and-deploying">Setup: Creating the Lambda function and deploying<a class="anchor-link" href="#Setup:-Creating-the-Lambda-function-and-deploying"> </a></h2><h3 id="Python-module-structure">Python module structure<a class="anchor-link" href="#Python-module-structure"> </a></h3><p>Like this</p>

<pre><code>lambdapi
├── src 
│   ├── __init__.py
│   ├── settings.py         # constants like AWS account
│   ├── main.py             # run me for instant results
|   └─── python_lambdas                   
|   |   └─── hello_world.py # serverless python function
│   ├── api_gateway.py      # boto3 for api_gateway
│   ├── lambda_functions.py # boto3 lambda
│   └── helpers.py          # file operations
└── ...</code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="AWS-Permissions-with-IAM">AWS Permissions with IAM<a class="anchor-link" href="#AWS-Permissions-with-IAM"> </a></h3><p>IAM Resources used - policies and roles.</p>
<p>IAM Policies define the effect, actions, resources and optional conditions in a JSON document.</p>
<p>An IAM user is a person or service that interacts with AWS with their own access to the management console. A user can have a policy attached to them. In this case it is more appropriate to grant policy access with an IAM role.
When assuming an IAM role (see Trusted Entity), access to a service can be granted to a user without having to give them new keys as the user can use temporary security tokens.</p>
<p>Create an IAM Lambda access policy for IAM using an IAM client that you create.</p>
<p>The access definition is provided in an <code>s3_access_policy_document</code></p>
<ul>
<li>JSON dictionary </li>
<li>Action key <code>Statement</code> with <ul>
<li>all S3 permissions</li>
<li>Cloudwatch to create log groups and streams for monitoring of the lamdba events</li>
</ul>
</li>
</ul>
<p>After creating a policy, create role and attach it to an execution role by assuming the role.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Verifying-the-Lambda-was-created-on-AWS-Console">Verifying the Lambda was created on AWS Console<a class="anchor-link" href="#Verifying-the-Lambda-was-created-on-AWS-Console"> </a></h3><p>By way of sanity check, we can verify the Lambda function has been uploaded in the AWS Console.</p>
<p>For the appropriate region, you may see the function, memory, timeout and our chosen permissions.</p>
<p><img src="https://i.imgur.com/RoOfCJt.gif" alt="Animation of Console"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr>
<h2 id="Resources-used:-with-thanks-&#128154;">Resources used: with thanks &#128154;<a class="anchor-link" href="#Resources-used:-with-thanks-&#128154;"> </a></h2><ul>
<li><p>Niyazi Erdogan's O'Reilly course - Build and Deploy Lambda functions AWS and Python <a href="https://learning.oreilly.com/videos/build-and-deploy/9781838557751">Videos</a></p>
</li>
<li><p>Building Lambda Functions with Python <a href="https://docs.aws.amazon.com/lambda/latest/dg/lambda-python.html">AWS docs</a></p>
</li>
<li>boto3 AWS Python SDK <a href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/lambda.html#lambda">lambda docs</a></li>
<li><a href="https://docs.aws.amazon.com/lambda/latest/dg/lambda-intro-execution-role.html">AWS Lambda Execution role</a></li>
<li>Using AWS Lambda with Amazon API Gateway <a href="https://docs.aws.amazon.com/lambda/latest/dg/services-apigateway-tutorial.html">AWS Tutorial</a></li>
<li>Setting up API Gateway and integrating it with Lambda proxy in Richard T. Freeman's serverless microservice course <a href="https://learning.oreilly.com/videos/building-a-scalable/9781788622318/9781788622318-video4_3">O'Reilly Videos</a></li>
</ul>

</div>
</div>
</div>
</div>
 

