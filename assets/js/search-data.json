{
  
    
        "post0": {
            "title": "Book Notes - No Rules Rules",
            "content": "As soon as I saw the title, I knew this is a book I had to read. . NO RULES RULES . NETFLIX and the Culture of Reinvention . REED HASTINGS . ERIN MEYER . Just the bold title alone conveys frankness, boldness and candour to a potential reader. My hunch was that the storytelling would likely be engaging from such a creative company. . I‚Äôve many ideas deeply entrenched in the idea coninuous improvement - I created some software that helps do just that. Throughout reading, this book spoke to me. . It‚Äôs densely-packed with concepts and case-studies on effective communication and general work culture that speak to both the C-Suite and individual contributors alike. You may liken it to the way a great film or play is densely packed with themes, plots and dialogue without waste. . Netflix is an organisation that began life as a mail-order DVD company just before the dotcom boom of the late 90s. The book shows how the company has steadily transitioned to a global content video on demand streaming platform and production company in 20 years by explaining their attitude to human resources. . The book is written by Reed Hastings - Netflix CEO and Erin Meyer - an academic and author. . Individuals . Stunning Colleages, Talent Density, brilliant jerks . Mediocre performance gets a polite goodbye and generous severance . Freedom, Responsibility and Candour . High performance + Selfless candour = Extremely high performance . 4A+1 feedback guidelines . It‚Äôs the principle of honesty and candour that presents the need for some guidelines on feedback so a productive, harmonious work environment is kept. The 4As of feedback are introudced in the second chapter. The last section of the book on ‚ÄòGoing Global‚Äô revisits the points, adding an additional point that highlights the need for international sensitivity when communicating. . Aim to Assist (giving feedback) . Feedback must be given with positive intent . | Actionable (giving feedback) . Feedback must focus on what the recipient can do differently . | Appreciate (receiving feedback) . Our natrual inclidation is to get defensive when receiving criticism as we aim to protect our ego but will be more helpful for you to listen careful and consider with an open mind . | Accept or discard (receiving feedback) . We can teach each other to accept with grace or sincerity but the provider must understand that the desicion to react is up to the recipient. . | Adapt (receiving feedback) . Delivery and reaction requires empathy and understanding of the culture you‚Äôre working with to get the results you need . | Connecting the dots . Dot 1 . Stunning Colleages / Talent density . My rating: 4/5 . . Unstructured Book Notes . Section One - First steps to Freedom &amp; Responsibility . Section Two - Next steps to a culture of Freedom &amp; Responsibility . Section Three - Techniques used to reinforce the culture of freedom and responsbility . Section Four - Going Global .",
            "url": "https://words.howapped.com/book%20notes/work%20life/non-fiction/2021/02/07/book-notes-no-rules-rules-netflix.html",
            "relUrl": "/book%20notes/work%20life/non-fiction/2021/02/07/book-notes-no-rules-rules-netflix.html",
            "date": " ‚Ä¢ Feb 7, 2021"
        }
        
    
  
    
        ,"post1": {
            "title": "AWS Certified Solutions Architect - Exam Differences",
            "content": "AWS have released an update on their most popular and wide-ranging certification course. . The software architect exam at associate level SAA-C01 has been retired and SAA-C02 takes its place. . Commenters with experience of the two will maintain that as long as you keep to the fundamentals of the 5 pillars of the well-architected framework, the two exams have mostly the same content. . It pays to be aware of the new products AWS offer. We know that being able to leverage natively provided technologies from a cloud provider will often present efficiency gains in the Software Development Lifecycle. . In the SAA-C02 exam, the new technologies we should be aware of: . Name ¬† . AWS Global Accelerator | ¬† | ¬† | ¬† | . Elastic Fabric Adapter | ¬† | ¬† | ¬† | . Elastic Network Adapter | ¬† | ¬† | ¬† | . AWS Parallel Cluster | ¬† | ¬† | ¬† | . Amazon FSx | ¬† | ¬† | ¬† | . AWS DataSync | ¬† | ¬† | ¬† | . AWS Directory Service | ¬† | ¬† | ¬† | . High Performance Computing | ¬† | ¬† | ¬† | . Aurora Serverless | ¬† | ¬† | ¬† | .",
            "url": "https://words.howapped.com/aws/2020/07/28/AWS-architect-exam-differences.html",
            "relUrl": "/aws/2020/07/28/AWS-architect-exam-differences.html",
            "date": " ‚Ä¢ Jul 28, 2020"
        }
        
    
  
    
        ,"post2": {
            "title": "Computers are fast - A cheatsheet",
            "content": "This is inspired by Julia Evans and Kamal Marhubi‚Äôs excellent mini-quiz on the data rates of systems and components. . The below cheatsheet serves as a summary of those benchmark speeds, for at-a-glance consumption. . Orders of magnitude . The idea is not necessarily know the exact figures for a particular benchmark, just the right order of magnitude. . üêå 100 1 . ü¶• 101 10 . üö∂ 102 100 . üèÉ‚Äç‚ôÄÔ∏è 103 1,000 . üèá‚Äç 104 10,000 . ‚ÄçüèéÔ∏èüí® 105 100,000 . üöÅ 106 1,000,000 . ‚úàÔ∏è 107 10,000,000 . üöÄ 108 100,000,000 . üå† 109 1,000,000,000 . ‚ÄòHow much can be done in a second‚Äô . sum.c . Each loop adds to total | How many loop iterations per second? üöÄ - üå† | Between 100 million and 1 Billion | 108 &gt; and &lt; 109 | . | . loop.py . Empty loop contents | How many loop iterations per second? ‚úàÔ∏è - üöÄ | Between 10m and 100m | 107 &gt; and &lt; 108 | . | . dict.py . Add elements to a fixed-size dictionary | How many loop iterations per second? ‚úàÔ∏è - üöÄ | Between 10m and 100m | 104 &gt; and &lt; 105 | . | . parse_http_request.py . Using Python built-in HTTP request parser | How many HTTP requests parsed per second? üèá‚ÄçÔ∏è - ‚ÄçüèéÔ∏èüí®‚Äç | Between 10,000 and 100,000 | 104 &gt; and &lt; 105 | . | . download_webpage.py . Downloading with urllib2 | How many HTTP requests completed per second? üêå‚ÄçÔ∏è - ‚Äçü¶• | Between 1 and 10 | The true cost depends on size, connection speed and distance from servers . | . | . run_python.sh . Running Python script(s) from bash | Bash loop iterations per second ü¶• - ‚Äçüö∂‚Äç | Between 10 and 100 | 101 &gt; and &lt; 102 | . | . write_to_disk.py . Code run on a machine with an SSD | How many bytes written to disk in a second üöÄ - üå† | Between 100 million and 1 Billion | . | How many megabytes written to disk in a second üö∂ - üèÉ‚Äç‚ôÄÔ∏è | Between 100 and 1,000 | My T480s running Ubuntu with SSD reports write speed: 2.3 GB/s and read 673 MB/s 1 | . | . write_to_memory.py . How many bytes written to a string in memory in a second üå†+ | Above 1 Billion | . | . grep_bytes.sh . Bytes search in a second üå†+ | Above 1 Billion | . | . find-filenames.sh . Files come from the filesystem cache | How many files listed in one second? üèéüí® - ‚ÄçüöÅ | Between 100,000 and 1m | 105 &gt; and &lt; 106 | Grep can search at 2GB/s so more limited by disk speed than grep‚Äôs speed . | . | . json_parse.py . Deserializing the same 65k of JSON repeatedly | How many loop iterations in a second? üö∂ - ‚ÄçüèÉ‚Äç‚ôÄÔ∏è | Between 100 and 1,000 | 102 &gt; and &lt; 103 | . | . msgpack_parse.py . Parse 46k of msgpack data | How many loop iterations in a second? üèÉ‚Äç‚ôÄÔ∏è - ‚Äçüèá‚Äç | Between 1,000 and 10,000 | 103 &gt; and &lt; 104 | Your choice of format and deserialisation library (eg capnproto) makes a big difference . | . | . database_indexed.py . Select one row from an indexed sqlite table containing 10m rows | How many queries in one second ‚Äçüèá‚Äç - üèéÔ∏èüí® | Between 10,000 and 100,000 | 104 &gt; and &lt; 105 | Typical query in 20 microseconds | . | . database_unindexed.py . Select one row from an unindexed sqlite table containing 10m rows | How many queries in one second üêå‚ÄçÔ∏è - ‚Äçü¶• | Between 1 and 10 | 100 &gt; and &lt; 101 | . | . hash.py . How many bytes hashed in one second? üöÄ - üå† | Between 100 million and 1 Billion | 108 &gt; and &lt; 109 | MD5 is designed to be fast . | . | . bcrypt_hash.py . Number of passwords hashed in a second? üêå‚ÄçÔ∏è - ‚Äçü¶• | Between 1 and 10 | 100 &gt; and &lt; 101 | . | . fill_array.c . Memory is accessed sequentially from a CPU cache | Number of passwords hashed in a second? üöÄ - üå† | Between 100 million and 1 Billion | 108 &gt; and &lt; 109 | . | . fill_array.c . Number of passwords hashed in a second? ‚úàÔ∏è - üöÄ | Between 10m and 100m | 104 &gt; and &lt; 105 | . | . Resources used: with thanks üíö . Do you know how much your computer can do in a second? - Mini Quiz | . https://www.binarytides.com/linux-test-drive-speed/¬†&#8617; . |",
            "url": "https://words.howapped.com/cheatsheet/python%20performance/2020/07/23/computers-are-fast-cheatsheet.html",
            "relUrl": "/cheatsheet/python%20performance/2020/07/23/computers-are-fast-cheatsheet.html",
            "date": " ‚Ä¢ Jul 23, 2020"
        }
        
    
  
    
        ,"post3": {
            "title": "Book Notes - Managing Humans",
            "content": "I (Jon) have recently finished this book about management and leadership. It does a great job in explaining empathy, archetypes and ‚Äògeneral craziness of dysfunctional bright people‚Äô with plenty of pertinent and amusing anecodotes. . It‚Äôs written for aspiring and current managers and at 3rd edition, Michael writes as though he knows his audience well. He has clearly trodden the boards, delivered software projects, and led teams at Borland and Apple. . My rating: 4/5 . Chapter Notes . CH4 - Rands Test . Where the ‚ÄòJoel test‚Äô can be an effective way to get a health check on a software team, the Rands test does the same for general team fitness in the context of management. . A score of 10 or lower - ‚Äòyou‚Äôve got serious problems‚Äô . Do you have consistent one-on-ones, about topics other than status? (+1) | Do you have consistent team meetings? (+1) | Are handwritten status reports delivered weekly via email? (-1) | Are you comfortable saying ‚Äòno‚Äô to your boss? (+1) | Can you explain the strategy of your company to a stranger? (+1) | Can you explain current health of the business? (+1) | Is there a regular stand-up by the person in charge? Do you buy it? (+1) | Do you know what you want to do next? (+1) Does your boss? (+1) | Do you have time to be strategic? (+1) | Are you actively killing the grapevine? ie. Do you make a point to kill gossip? (+1) | . CH39 - Incrementalist vs. Realists . Incrementalists and Realists don‚Äôt disagree about whether or not we should do something about the problem. We are disagreeing about how much we should do. ‚Ä¶ There are two distinct personalities when it comes to devising solutions. . Incrementalists are realists and they have a pretty good idea of what is achievable given a problem to solve, a product to ship. ‚Ä¶ They tend to know all the secrets. . Completionists are dreamers. Their mantra is ‚ÄúIf you‚Äôre going to spend the time given to solve a problem, solve it in a manner so you aren‚Äôt going to be solving it again in 3 months‚Äù . Incrementalists need vision and are driven by the goal of progress and constantly moving forward. . Completionists can often see the immediate solution, and the two-year solution and the five-year solution. . CH40 - Organics and Mechanics . The chapter covers how to speak to your manager and to identify if they are one of two personalities and the interpersonal conflict that may arise between the two. Lopp comments that the ensuing ‚Äòorganisational warfare‚Äô is a waste of time (and money) as it focuses everyone on the peculiar personality quirks of the other rather than on the business. . Mechanics move forward methodically. They carefully gather information in a structured manner. They quietly observe and are comfortable predictable. They annoy the hell out of the organics . Organics are all over the place. They tend to be loud and can tell a joke. They ask seemingly meaningless questions. . Mechanic: ‚ÄúThis guy is walking chaos‚ÄùOrganic: ‚ÄúThis guy is totally uptight‚Äù . CH52 - Chaotic, Beautiful snowflakes . Engineers have a well-deserved reputation for regularly being off by a factor of three in their work estimates, partly due to the fact that we are really shitty at estimating the no-linear chaotic work that exists in keeping a group of humans pointed in the right direction. . Michael‚Äôs parting thought . The hard work of great leadership isn‚Äôt just managing the expected tasks that we can predict - it‚Äôs the art of successfully traversing the unexpected. .",
            "url": "https://words.howapped.com/book%20notes/work%20life/non-fiction/2020/07/19/book-notes-managing-humans.html",
            "relUrl": "/book%20notes/work%20life/non-fiction/2020/07/19/book-notes-managing-humans.html",
            "date": " ‚Ä¢ Jul 19, 2020"
        }
        
    
  
    
        ,"post4": {
            "title": "Scheduled Severless Startup",
            "content": "The Problem . As part of the early Covid-19 response, Digital Ocean donated some free credit to us to host an app for a local food delivery scheme. . To make that credit go as far as possible and to minimise power consumption, we&#39;d like to power up and down the servers according to a schedule. . The Solution . Here&#39;s how to do that with AWS Lambda, with cloudfront events. We iterate on that to use the Serverless Framework. . TLDR; Have a look at the companion repo.. It contains an example dockerized web app and the shell scripts for starting containers and creating the service. . This article covers how to automate with a Digital Ocean droplet so to follow along with the code, you can create one using the example from a previous article. . We will examine the cURL statements, convert those into Python. We can use AWS Lambda to execute the Python in a serverless environment. Then, the AWS lambda functions can be triggered by Cloudwatch events to a schedule so machines can be brought online only during operating hours. . We can notify any interested parties using Microsoft Teams - a topic for a subsequent post. . Prerequisites . You can always check the companion repo. . You will need to: . .. have jq installed to format JSON responses Download JQ for your OS | . | . .. have a server on which a dockerized web app will start automatically when the server is restarted See previous article on how to create one with DigitalOcean. | . | . .. have installed Boto3 with your AWS account credentials so we can work with the AWS Python SDK. | . cURL statements to boot down and up . As covered in a previous post, our web app will restart when rebooted using a systemd service. . Rather than ssh or the cloud provider&#39;s control panel, the server can be started and stopped using cURL. . In the case of DigitalOcean: . Find out the ID of the server: . $ curl -H &#39;Content-Type: application/json&#39; -H &#39;Authorization: Bearer &#39;$DIGITAL_OCEAN_ACCESS_TOKEN&#39;&#39; &quot;https://api.digitalocean.com/v2/droplets?name=scheduled-serverless&quot; | jq &#39;.droplets[] | {id:.id, name:.name, status: .status}&#39; . The output gives us the ID . { ... }, { &quot;id&quot;: 195786885, &quot;name&quot;: &quot;scheduled-serverless&quot;, &quot;status&quot;: &quot;active&quot; } . And then power it down: . $ curl -X POST -H &#39;Content-Type: application/json&#39; -H &#39;Authorization: Bearer &#39;$DIGITAL_OCEAN_ACCESS_TOKEN&#39;&#39; -d &#39;{&quot;type&quot;:&quot;power_off&quot;}&#39; &quot;https://api.digitalocean.com/v2/droplets/195786885/actions&quot; | jq &#39;.[] | {id:.id, status:.status, type:.type}&#39; . Which tells us it&#39;s in progress . { &quot;id&quot;: 955320153, &quot;status&quot;: &quot;in-progress&quot;, &quot;type&quot;: &quot;power_off&quot; } . The equivalent cURL for powering on the server is virtual identical . $ curl -X POST -H &#39;Content-Type: application/json&#39; -H &#39;Authorization: Bearer &#39;$DIGITAL_OCEAN_ACCESS_TOKEN&#39;&#39; -d &#39;{&quot;type&quot;:&quot;power_on&quot;}&#39; &quot;https://api.digitalocean.com/v2/droplets/195786885/actions&quot; | jq &#39;.[] | {id:.id, status:.status, type:.type}&#39; . The web app from the example is running on port 80. We know the server&#39;s IP address by referring to the control panel. Let&#39;s confirm that the service is running by verifying the output in a browser. . . Requests scripts in AWS Lambda . The cURL statements in Python . First, get the ID of the droplet. . import os import sys import requests TOKEN = os.getenv(&#39;DIGITAL_OCEAN_ACCESS_TOKEN&#39;,&#39;&#39;) DROPLET_NAME = &#39;scheduled-serverless&#39; headers = { &#39;Content-Type&#39;: &#39;application/json&#39;, &#39;Authorization&#39;: f&#39;Bearer {TOKEN}&#39;, } if TOKEN == &#39;&#39;: sys.exit(&#39;Your environment should have the `DIGITAL_OCEAN_ACCESS_TOKEN exported.&#39;) def get_droplet(): response = requests.get(&#39;https://api.digitalocean.com/v2/droplets&#39;, headers=headers, params={}) return [d for d in response.json().get(&#39;droplets&#39;,{}) if d.get(&#39;name&#39;,&#39;&#39;) == DROPLET_NAME][0] DROPLET = get_droplet() print(f&#39;Droplet ID: {DROPLET.get(&quot;id&quot;)}&#39;) . Droplet ID: 195786885 . Now we have the ID, let&#39;s define the functions for bringing the servers down and back up. . def power_off() -&gt; dict: data = &#39;{&quot;type&quot;:&quot;power_off&quot;}&#39; url = f&#39;https://api.digitalocean.com/v2/droplets/{DROPLET.get(&quot;id&quot;)}/actions&#39; response = requests.post(url, headers=headers, data=data) return response.json() def power_on() -&gt; dict: data = &#39;{&quot;type&quot;:&quot;power_on&quot;}&#39; url = f&#39;https://api.digitalocean.com/v2/droplets/{DROPLET.get(&quot;id&quot;)}/actions&#39; response = requests.post(url, headers=headers, data=data) return response.json() action_resp = power_off() print(action_resp[&#39;action&#39;][&#39;type&#39;]) print(action_resp[&#39;action&#39;][&#39;status&#39;]) print(&#39;-&#39;) # action_resp = power_on() # print(action_resp[&#39;action&#39;][&#39;type&#39;]) # print(action_resp[&#39;action&#39;][&#39;status&#39;]) . power_off in-progress - . Running the scripts in AWS Lambda . Let&#39;s translate the cURL statements into Python. . # Popping on a new on/off timestamp on a firebase stored stack import requests import arrow start: dict = {&#39;off&#39;: [&#39;2020-08-11 09:04&#39;], &#39;on&#39;: [&#39;2020-08-11 09:03&#39;]} # get data url = &#39;https://wordsdothowappeddotcom.firebaseio.com/scheduled-serverless-startup.json?print=pretty&#39; r = requests.get(url, data={}, headers={},) data = r.json() print(data) # replace data print(data[&#39;off&#39;][0]) . ModuleNotFoundError Traceback (most recent call last) In [12]: Line 4: import arrow ModuleNotFoundError: No module named &#39;arrow&#39; . Schedule the scripts with Cloudwatch events . Putting it all together in a Serverless Application Framework template . Quality of Life enhancements . When the target service is unavailable, it&#39;s quite unfriendly to show a blank 500 screen. A subsequent post outlines a solution for a forwarding service which can display an Open/Closed for business page to the user, with &#39;Opening times&#39; . As part of what&#39;s become known as &#39;Chatops&#39;, it&#39;s useful to update team members and stakeholders about the status of the server. A future addition will be to use the Microsoft Teams API to notify interested parties. . Resources used: with thanks &#128154; . Curl converter Github repo | . AWS Lambda and Secret Management Overview Blog post from Espagon . | Sharing Secrets with AWS Lambda Using AWS Systems Manager Parameter Store AWS Compute blog post . | .",
            "url": "https://words.howapped.com/aws%20lambda/automation/python/2020/07/15/scheduled-serverless-startup.html",
            "relUrl": "/aws%20lambda/automation/python/2020/07/15/scheduled-serverless-startup.html",
            "date": " ‚Ä¢ Jul 15, 2020"
        }
        
    
  
    
        ,"post5": {
            "title": "hello world serverless microservice",
            "content": "Problem . We&#39;ve been asked for an API that will work at web scale and be cost effective. A serverless API is perfect for this. . What are the constituent parts needed to start working with the AWS SDK with Python and steps needed to write and execute a serverless script with AWS Lambda. How can this script be invoked by an HTTP endpoint? . Solution . The companion repo consists utility code for deploying the lambda with boto3 as well as detail on the AWS API Gateway service that provides an endpoint to invoke the serverless function. . This is the end product; A serverless endpoint. . . The code can be found on Github.. . Once cloned, install dependencies, set your AWS account ID as an environment variable and run it. . (venv) (base) $ python src/main.py ‚úÖ Remove existing named lambda/api ‚úÖ Create the lambda ‚úÖ Deploy the lambda ‚úÖ Remove any existing API ‚úÖ Create API ‚úÖ Deploy API ‚úÖ Test API SERVERLESS ENDPOINT RESPONSE from https://qvaik2un06.execute-api.eu-west-2.amazonaws.com/hello-world : b&#39;{&quot;querystring_params:&quot;: {}, &quot;err&quot;: null, &quot;message&quot;: &quot;Hello Serverless World&quot;}&#39; . Setup: Creating the Lambda function and deploying . Python module structure . Like this . lambdapi ‚îú‚îÄ‚îÄ src ‚îÇ ‚îú‚îÄ‚îÄ __init__.py ‚îÇ ‚îú‚îÄ‚îÄ settings.py # constants like AWS account ‚îÇ ‚îú‚îÄ‚îÄ main.py # run me for instant results | ‚îî‚îÄ‚îÄ‚îÄ python_lambdas | | ‚îî‚îÄ‚îÄ‚îÄ hello_world.py # serverless python function ‚îÇ ‚îú‚îÄ‚îÄ api_gateway.py # boto3 for api_gateway ‚îÇ ‚îú‚îÄ‚îÄ lambda_functions.py # boto3 lambda ‚îÇ ‚îî‚îÄ‚îÄ helpers.py # file operations ‚îî‚îÄ‚îÄ ... . AWS Permissions with IAM . IAM Resources used - policies and roles. . IAM Policies define the effect, actions, resources and optional conditions in a JSON document. . An IAM user is a person or service that interacts with AWS with their own access to the management console. A user can have a policy attached to them. In this case it is more appropriate to grant policy access with an IAM role. When assuming an IAM role (see Trusted Entity), access to a service can be granted to a user without having to give them new keys as the user can use temporary security tokens. . Create an IAM Lambda access policy for IAM using an IAM client that you create. . The access definition is provided in an s3_access_policy_document . JSON dictionary | Action key Statement with all S3 permissions | Cloudwatch to create log groups and streams for monitoring of the lamdba events | . | . After creating a policy, create role and attach it to an execution role by assuming the role. . Verifying the Lambda was created on AWS Console . By way of sanity check, we can verify the Lambda function has been uploaded in the AWS Console. . For the appropriate region, you may see the function, memory, timeout and our chosen permissions. . . ## Testing the endpoint ## Parting Note This brief walkthrough essentially achieves the same solution as the AWS Serverless Application model &#39;Hello World&#39; tutorial. . Alternative Solution . The AWS Serverless Application Model is a framework that allows you to build and deploy serverless applications. . You may declare the lambda functions to be used and additional resources like APIs and database in a YAML template. It uses an implementation of AWS CloudFormation to define these resources provides myriad other benefits. . The AWS Hello World SAM tutorial covers what we outlined manually above and also shows how to run the Lambda and API route locally and remove the CloudFormation stack to clean up. . However, when dissecting software to understand a technique, it&#39;s always useful to strip away layers of abstraction. . . Resources used: with thanks &#128154; . Niyazi Erdogan&#39;s O&#39;Reilly course - Build and Deploy Lambda functions AWS and Python Videos . | Building Lambda Functions with Python AWS docs . | boto3 AWS Python SDK lambda docs | AWS Lambda Execution role | Using AWS Lambda with Amazon API Gateway AWS Tutorial | Setting up API Gateway and integrating it with Lambda proxy in Richard T. Freeman&#39;s serverless microservice course O&#39;Reilly Videos | AWS SAM Hello World Tutorial - AWS Docs | .",
            "url": "https://words.howapped.com/aws%20lambda/boto3/python/aws%20api%20gateway/2020/07/01/serverless-endpoint-with-aws-lambda-api-gateway-and-boto3.html",
            "relUrl": "/aws%20lambda/boto3/python/aws%20api%20gateway/2020/07/01/serverless-endpoint-with-aws-lambda-api-gateway-and-boto3.html",
            "date": " ‚Ä¢ Jul 1, 2020"
        }
        
    
  
    
        ,"post6": {
            "title": "Scheduled Severless Startup",
            "content": "The Problem . As part of the Covid-19 effort, Digital Ocean donated some free credit to us to work on a local food delivery scheme. . To make that credit go as far as possible and to minimise power consumption, we&#39;d like to power up and down the servers according to a schedule. . The Solution . Esimated cost saving... . Here&#39;s how to do that with AWS Lambda, with cloudfront events. We iterate on that to use the Serverless Framework. . TLDR; Have a look at the companion repo.. It contains an example dockerized web app and the shell scripts for starting containers and creating the service. . This article covers how to automate with a Digital Ocean droplet so to follow along with the code, you can create one using the example from a previous article. . We will examine the cURL statements, convert those into Python. We can use AWS Lambda to execute the Python in a serverless environment. Then, the AWS lambda functions can be triggered by Cloudwatch events to a schedule so machines can be brought online only during operating hours. . We can notify any interested parties using Microsoft Teams - a topic for a subsequent post. . Prerequisites . You can always check the companion repo. . You will need to: . .. have jq installed to format JSON responses Download JQ for your OS | . | . .. have a server on which a dockerized web app will start automatically when the server is restarted See previous article on how to create one with DigitalOcean. | . | . .. have installed Boto3 with your AWS account credentials so we can work with the AWS Python SDK. | . cURL statements to boot down and up . As covered in a previous post, our web app will restart when rebooted using a systemd service. . Rather than ssh or the cloud provider&#39;s control panel, the server can be started and stopped using cURL. . In the case of DigitalOcean: . Find out the ID of the server: . $ curl -H &#39;Content-Type: application/json&#39; -H &#39;Authorization: Bearer &#39;$DIGITAL_OCEAN_ACCESS_TOKEN&#39;&#39; &quot;https://api.digitalocean.com/v2/droplets?name=scheduled-serverless&quot; | jq &#39;.droplets[] | {id:.id, name:.name, status: .status}&#39; . The output gives us the ID . { ... }, { &quot;id&quot;: 195786885, &quot;name&quot;: &quot;scheduled-serverless&quot;, &quot;status&quot;: &quot;active&quot; } . And then power it down: . $ curl -X POST -H &#39;Content-Type: application/json&#39; -H &#39;Authorization: Bearer &#39;$DIGITAL_OCEAN_ACCESS_TOKEN&#39;&#39; -d &#39;{&quot;type&quot;:&quot;power_off&quot;}&#39; &quot;https://api.digitalocean.com/v2/droplets/195786885/actions&quot; | jq &#39;.[] | {id:.id, status:.status, type:.type}&#39; . Which tells us it&#39;s in progress . { &quot;id&quot;: 955320153, &quot;status&quot;: &quot;in-progress&quot;, &quot;type&quot;: &quot;power_off&quot; } . The equivalent cURL for powering on the server is virtual identical . $ curl -X POST -H &#39;Content-Type: application/json&#39; -H &#39;Authorization: Bearer &#39;$DIGITAL_OCEAN_ACCESS_TOKEN&#39;&#39; -d &#39;{&quot;type&quot;:&quot;power_on&quot;}&#39; &quot;https://api.digitalocean.com/v2/droplets/195786885/actions&quot; | jq &#39;.[] | {id:.id, status:.status, type:.type}&#39; . The web app from the example is running on port 80. We know the server&#39;s IP address by referring to the control panel. Let&#39;s confirm that the service is running by verifying the output in a browser. . . Requests scripts in AWS Lambda . The cURL statements in Python . First, get the ID of the droplet. . import os import sys import requests TOKEN = os.getenv(&#39;DIGITAL_OCEAN_ACCESS_TOKEN&#39;,&#39;&#39;) DROPLET_NAME = &#39;scheduled-serverless&#39; headers = { &#39;Content-Type&#39;: &#39;application/json&#39;, &#39;Authorization&#39;: f&#39;Bearer {TOKEN}&#39;, } if TOKEN == &#39;&#39;: sys.exit(&#39;Your environment should have the `DIGITAL_OCEAN_ACCESS_TOKEN exported.&#39;) def get_droplet(): response = requests.get(&#39;https://api.digitalocean.com/v2/droplets&#39;, headers=headers, params={}) return [d for d in response.json().get(&#39;droplets&#39;,{}) if d.get(&#39;name&#39;,&#39;&#39;) == DROPLET_NAME][0] DROPLET = get_droplet() print(f&#39;Droplet ID: {DROPLET.get(&quot;id&quot;)}&#39;) . Droplet ID: 195786885 . Now we have the ID, let&#39;s define the functions for bringing the servers down and back up. . def power_off() -&gt; dict: data = &#39;{&quot;type&quot;:&quot;power_off&quot;}&#39; url = f&#39;https://api.digitalocean.com/v2/droplets/{DROPLET.get(&quot;id&quot;)}/actions&#39; response = requests.post(url, headers=headers, data=data) return response.json() def power_on() -&gt; dict: data = &#39;{&quot;type&quot;:&quot;power_on&quot;}&#39; url = f&#39;https://api.digitalocean.com/v2/droplets/{DROPLET.get(&quot;id&quot;)}/actions&#39; response = requests.post(url, headers=headers, data=data) return response.json() action_resp = power_off() print(action_resp[&#39;action&#39;][&#39;type&#39;]) print(action_resp[&#39;action&#39;][&#39;status&#39;]) print(&#39;-&#39;) # action_resp = power_on() # print(action_resp[&#39;action&#39;][&#39;type&#39;]) # print(action_resp[&#39;action&#39;][&#39;status&#39;]) . power_off in-progress - . Running the scripts in AWS Lambda . Let&#39;s translate the cURL statements into Python. . Schedule the scripts with Cloudwatch events . Serverless framework . Quality of Life enhancements . When the target service is unavailable, it&#39;s quite unfriendly to show a blank 500 screen. A subsequent post outlines a solution for a forwarding service which can display an Open/Closed for business page to the user, with &#39;Opening times&#39; . As part of what&#39;s become known as &#39;Chatops&#39;, it&#39;s useful to update team members and stakeholders about the status of the server. A future addition will be to use the Microsoft Teams API to notify interested parties. . Resources . Curl converter - [github] . convert curl commands to Python, JavaScript, PHP, R, Go, Rust, Dart, JSON, Ansible, Elixir . | .",
            "url": "https://words.howapped.com/aws%20lambda/automation/python/2020/06/11/scheduled-serverless-startup.html",
            "relUrl": "/aws%20lambda/automation/python/2020/06/11/scheduled-serverless-startup.html",
            "date": " ‚Ä¢ Jun 11, 2020"
        }
        
    
  
    
        ,"post7": {
            "title": "Automatically restart docker containers after reboot",
            "content": "The Problem . As part of Covid-19 relief, DigitalOcean donated some free credit for me to work on a local food delivery scheme. . I need to get most value for money by making that credit go as far as possible. It would also be nice to minimise power consumption. . The Solution . The server should be powered-down outside of operating hours and turned back on before start of business. This can be done using the cloud provider&#39;s control panel. . To avoid manual work starting the web app, a service is needed to bring the containers back online when the droplet is swtiched on. . Covered in this article is the process for using the DigitalOcean API to create a droplet with the requisite user_data for creating the systemd service to start containers at boot time. . TLDR; Have a look at the companion repo.. It contains an example dockerized web app and the shell scripts for starting containers and creating the service. . Not covered in this article is the process to automate the power down and up to a schedule. This is covered in a subsequent article. . Prerequisites . A Digital Ocean account (free trial available) | Generate an access token for accessing the DigitalOcean API | Add the token to your environment . $ export DIGITAL_OCEAN_ACCESS_TOKEN=XXXXXXXX . | jq installed to format JSON responses Download JQ for your OS | . | . Create a DigitalOcean droplet (optional) . If you already have a web server, with an app, move to section, &#39;Create a systemd service.&#39; . If you do not already have a web server, launch a Droplet with requisite SSH access. . cURL to create the droplet . This cURL statement creates an Ubuntu 18.04 server in London. The user_data key in the payload is used for defining various statements to execute once the server is created. In this case we are cloning the repo containing the dockerized app, starting it, and creating the systemd service to restart the app when the server boots up. . $ curl -X POST -H &#39;Content-Type: application/json&#39; -H &#39;Authorization: Bearer &#39;$DIGITAL_OCEAN_ACCESS_TOKEN&#39;&#39; -d &#39;{&quot;name&quot;:&quot;scheduled-serverless&quot;,&quot;region&quot;:&quot;lon1&quot;,&quot;size&quot;:&quot;s-2vcpu-4gb&quot;,&quot;image&quot;:&quot;docker-18-04&quot;, &quot;user_data&quot;: &quot;#!/bin/bash apt-get update apt-get upgrade -y git clone https://github.com/jonwhittlestone/scheduled-serverless-startup.git /root/scheduled-serverless-startup sh /root/scheduled-serverless-startup/start-containers.sh sh /root/scheduled-serverless-startup/create-service.sh&quot;}&#39; &quot;https://api.digitalocean.com/v2/droplets&quot; . SSH into your new droplet . You will be emailed your root password. After you SSH in using the provided password, you will be asked to change it. . . Test the web app is running . The app is running with Docker on port 80, so it&#39;s simply a case of: . root@scheduled-serverless:~# curl localhost A Howapped Project. . Test the service is running . Restart your server with . root@scheduled-serverless:~# sudo reboot . And then ssh and repeat the cURL statement to the web service . (base) ‚ûú ~ ssh root@167.172.56.239 curl localhost root@167.172.56.239&#39;s password: % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 0 0 0 0 0 0 0 0 --:--:-- --:--:-- --:--:-- 0 A Howapped Project. 100 22 100 22 0 0 1294 0 --:--:-- --:--:-- --:--:-- 1294 . Create a systemd service . Ubuntu&#39;s init system is called systemd and various flavours of Linux may have differing init systems. . Scripting the starting of the web app . We need to define what should be automated which is starting the containers. . In this case, I have an example dockerized app defined in the companion repo, so let&#39;s clone that. . If this directory is present (because it has been previously cloned), then just pull the latest changes. . #!/bin/bash if [ -d &quot;/root/scheduled-serverless-startup&quot; ] then git pull origin master else cd /root/scheduled-serverless-startup git clone https://github.com/jonwhittlestone/scheduled-serverless-startup.git /root/scheduled-serverless-startup fi cd /root/scheduled-serverless-startup/app docker-compose up -d . Lastly, we start containers with docker-compose . Using systemctl to enable the service . Using the interface systemctl we can manage the init system. Each service is called a unit file. This means loading a service, enabling at boot and restarting. . On an Ubuntu system, you may inspect the running services: . $ systemctl status | head ‚óè madebyjon State: running Jobs: 0 queued Failed: 0 units Since: Mon 2020-06-08 05:56:42 BST; 1 day 2h ago CGroup: / ‚îú‚îÄ3770 bpfilter_umh ‚îú‚îÄuser.slice ‚îÇ ‚îî‚îÄuser-1000.slice ‚îÇ ‚îú‚îÄuser@1000.service . The following shell script creates the unit file, enables it at boot and starts the service. . #!/bin/bash touch /etc/systemd/system/howapped.service cat &gt; /etc/systemd/system/howapped.service&lt;&lt;-EOF [Unit] Description=HowappedProjectStartOnBoot After=network.target [Service] Type=simple User=root WorkingDirectory=/root/scheduled-serverless-startup ExecStart=/bin/sh /root/scheduled-serverless-startup/start-containers.sh Restart=on-abort [Install] WantedBy=multi-user.target EOF systemctl daemon-reload systemctl enable howapped.service systemctl restart howapped.service . Enable the systemd service . The below excerpt verifies we have the working directory created. . root@scheduled-serverless:~/scheduled-serverless-startup# ls README.md app create-service.sh Vagrantfile cloud-config.yaml start-containers.sh root@scheduled-serverless:~/scheduled-serverless-startup# pwd /root/scheduled-serverless-startup . And this runs the shell script to create the unit file and enable it. . root@scheduled-serverless:~/scheduled-serverless-startup# sh create-service.sh Created symlink /etc/systemd/system/multi-user.target.wants/howapped.service ‚Üí /etc/systemd/system/howapped.service. . Test it . We will use the CURL statement to find the ID of our droplet, so that we can then use a CURL statement to power down the machine. . $ curl -H &#39;Content-Type: application/json&#39; -H &#39;Authorization: Bearer &#39;$DIGITAL_OCEAN_ACCESS_TOKEN&#39;&#39; &quot;https://api.digitalocean.com/v2/droplets?name=scheduled-serverless&quot; | jq &#39;.droplets[] | {id:.id, name:.name, status: .status}&#39; { &quot;id&quot;: 195393249, &quot;name&quot;: &quot;scheduled-serverless&quot;, &quot;status&quot;: &quot;on&quot; } # power it down $ curl -X POST -H &#39;Content-Type: application/json&#39; -H &#39;Authorization: Bearer &#39;$DIGITAL_OCEAN_ACCESS_TOKEN&#39;&#39; -d &#39;{&quot;type&quot;:&quot;power_off&quot;}&#39; &quot;https://api.digitalocean.com/v2/droplets/195393249/actions&quot; | jq &#39;.[] | {id:.id, status:.status, type:.type}&#39; . We power it back up: . $ curl -X POST -H &#39;Content-Type: application/json&#39; -H &#39;Authorization: Bearer &#39;$DIGITAL_OCEAN_ACCESS_TOKEN&#39;&#39; -d &#39;{&quot;type&quot;:&quot;power_on&quot;}&#39; &quot;https://api.digitalocean.com/v2/droplets/195393249/actions&quot; | jq &#39;.[] | {id:.id, status:.status, type:.type}&#39; { &quot;id&quot;: 953153688, &quot;status&quot;: &quot;in-progress&quot;, &quot;type&quot;: &quot;power_on&quot; } . And verify our app is running. . $ ssh root@104.248.174.117 curl localhost root@104.248.174.117&#39;s password: % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 0 0 0 0 0 0 0 0 --:--:-- --:--:-- --:--:-- 0 A Howapped Project. . Clean up . If you were following along by creating a DigitalOcean droplet, you may wish to power down or destroy the machine if not in use. . . Resources . Linode - Introduction to Systemctl | .",
            "url": "https://words.howapped.com/systemd/automation/2020/06/01/automatically-restart-docker-after-reboot-with-service.html",
            "relUrl": "/systemd/automation/2020/06/01/automatically-restart-docker-after-reboot-with-service.html",
            "date": " ‚Ä¢ Jun 1, 2020"
        }
        
    
  

  
  

  
      ,"page1": {
          "title": "Contact",
          "content": "Howapped is a software consultancy from UK run by me, Jon. . Hello ü§ì . howapped words covers project updates and my learnings from the Howapped labs 1. . I‚Äôm an end-to-end product engineer and help SaaS companies retain larger, more valuable subscribers. . Please contact for project or mentorship opportunities words@howapped.com . This website is powered by fastpages . not really a lab with test tubes and stuff.¬†&#8617; . |",
          "url": "https://words.howapped.com/contact/",
          "relUrl": "/contact/",
          "date": ""
      }
      
  

  

  
  

  

  
  

  

  
  

  
  

  
  

  
      ,"page10": {
          "title": "",
          "content": "Sitemap: {{ ‚Äúsitemap.xml‚Äù | absolute_url }} | .",
          "url": "https://words.howapped.com/robots.txt",
          "relUrl": "/robots.txt",
          "date": ""
      }
      
  

}