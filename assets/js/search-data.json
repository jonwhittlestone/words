{
  
    
        "post0": {
            "title": "An ASCII Art Guide to OAuth and OpenID Connect (with added SPA)",
            "content": "The following shows the OAuth2.0 flow for granting access to your API, with the OpenID connect layer for communicating identity information about the user. . Simple OIDC Flow between Resource Server and Auth Server . 1. Resource server (our api) &gt;-&gt;-&gt;-&gt;-&gt;-&gt;-&gt;-&gt;-&gt;-&gt; Auth server (Okta) - API route: /authorization-code/login - Description: redirect to auth server login. The resource service and therefore client, expects to receive an authorisation code - Python function: authorize() - Example login url - https://newscorp.oktapreview.com/oauth2/default/v1/authorize?client_id=0oa10kbogxjjvDCUW0h8&amp;response_type=code&amp;scope=openid profile email&amp;state=cd0348b84d8f45a8808a39d5763b49a3&amp;nonce=c96bdb88ef184a8caaedeefd366e8881&amp;redirect_uri=http://127.0.0.1:3001/authorization-code/callback 2. Resource server (our api) &lt;-&lt;-&lt;-&lt;-&lt;-&lt;-&lt;-&lt;-&lt;-&lt; Auth server (Okta) - API route: /authorization-code/callback - Description: Get tokens Swap the auth_code and client_secret for an access token. This is the key that the client will use from that point forward to communicate with the resource server. - Python function: callback() - Example to get tokens by providing client_secret: - https://newscorp.oktapreview.com/oauth2/default/v1/token?client_id=0oa10kbogxjjvDCUW0h8&amp;client_secret=5ketFKpwhMGGSnpJyMNLiYlQfrLxhksJDTerqwof&amp;grant_type=authorization_code&amp;redirect_uri=http://127.0.0.1:3001/authorization-code/callback&amp;code=DpgBENTLyEV0ZlG9MTv9kGWaTMH2G8nnoh0PejbUvAE . Advanced OIDC Flow between SPA, Resource Server and Auth Server . Front Channel means non-trusted communication from the browser . â¼â¼â¼â¼&gt; . Back Channel means â€˜trust in the connectionâ€™ . â¼ â¼ â¼&gt; . || ğŸ§” || || ğŸ’» || || ğŸ’» || ============================================================================= . SPA (F/E) â¼â¼â¼â¼&gt; Resource Server (API) Auth Server (Okta) XHR request in JS to /api/login | API gets secrets for authorize url (eg client_id) | API returns login_url containing authorize url for Okta Response payload | . | SPA (F/E) &lt;â¼ â¼ â¼ Resource Server (API) Auth Server (Okta) API returns json object with login url | {â€œlogin_urlâ€: https://newscorp.oktapreview.com/oauth2/default/v1/authorize?client_id=0oa10kbogxjjvDCUW0h8&amp;response_type=code&amp;scope=openid profile email&amp;state=cd0348b84d8f45a8808a39d5763b49a3&amp;nonce=c96bdb88ef184a8caaedeefd366e8881&amp;redirect_uri=http://127.0.0.1:3001/authorization-code/callback} | . | SPA (F/E) â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼&gt; Auth Server (Okta) Frontend pushes user to the login_url | . | SPA (F/E) &lt;â¼ â¼ â¼ â¼ â¼ â¼ â¼ â¼ â¼ â¼ â¼ â¼ â¼ â¼ â¼ â¼ â¼ â¼ â¼ â¼ Auth Server (Okta) The user will receive Okta challenge login page | . | SPA (F/E) â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼&gt; Auth Server (Okta) User submits credentials and/or 2FA | . | SPA (F/E) &lt;â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼â¼ Auth Server (Okta) If credentials are good the callback on the F/E can proceed | The authorisation code is granted. (â€œcode grantâ€) | GET https://{CLIENT_URL}/callback?code={UNIQUE_CODE} | . | SPA (F/E) â¼â¼â¼â¼&gt; Resource Server (API) Auth Server (Okta) XHR request in JS to /api/callback?code={UNIQUE_CODE} | . | SPA (F/E) Resource Server (API) â¼â¼â¼â¼&gt; Auth Server (Okta) The code grant is then used to retrieve an access token from Okta | The API has the client secret. We have kept it secure and not exposed in in frontend. | POST https://{OKTA_DOMAIN}/token?code={UNIQUE_CODE}&amp;{CLIENT_ID}&amp;client_secret={CLIENT_SECRET} | . | SPA (F/E) Resource Server (API) &lt;â¼ â¼ â¼ Auth Server (Okta) Okta replies to our API with the access token | status=200, data={ACCESS_TOKEN} â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ Optional - user info â”‚ â”‚ | â”‚ SPA (F/E) Resource Server (API) â”€â”€â”€â”€â”€â”€â”€â–º Auth Server (Okta) | â”‚ - Access /userinfo using access token | â”‚ - https://{OKTA_DOMAIN}/userinfo header {Authorization: Bearer {ACCESS_TOKEN} | â”‚ â”‚ â”‚ SPA (F/E) Resource Server (API) â—„â”€ - - - - Auth Server (Okta) â”‚ â”‚ - status=200, data={USER_INFO} â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ | . | 10 SPA (F/E) &lt;â¼ â¼ â¼ Resource Server (API) Auth Server (Okta) . Generate a JWT on our API and send back to frontend to avoid exposing the Okta token | status=200, data={JWT_TOKEN} | . â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚ ğŸ† State = User Authenticated ğŸ† â”‚ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ .",
            "url": "https://words.howapped.com/authentication/single%20sign%20on/sso/2022/09/14/spa-react-oidc-oauth-flow-okta.html",
            "relUrl": "/authentication/single%20sign%20on/sso/2022/09/14/spa-react-oidc-oauth-flow-okta.html",
            "date": " â€¢ Sep 14, 2022"
        }
        
    
  
    
        ,"post1": {
            "title": "DNS for Developers",
            "content": "Networking for Devs - DNS FAQ . . As a senior developer, itâ€™s clear some other technical staff lack a working knowledge of the Domain Name System. . Hereâ€™s an explainer, using the Cornell method - my favourite way to work through a subject quickly. . Cornell Method notes . Q A . What is DNS and a DNS query? | Domain Name System is used to map human-friendly service names (&#39;hosts&#39;) to the resource&#39;s numerical addresses (IP addresses) A DNS query and how it is resolved is the process of translating the human-friendly computer host names into IP addresses. DNS &#39;resolution&#39; and &#39;translation&#39; are the same thing. | . How does a DNS query get resolved? | When a user enters https://blog.howapped.com, the browser initiates a DNS resolver which sequences the query that ultimately leads to a translation. The recursive resolver function looks in cache 1. If not in cache, it goes to the first of the authoritative nameservers. This is hardcoded in the OS. For example `8.8.8.8` 2. If translation not found, continue querying 3. Resolver -- queries --&gt; internal cache 4. Resolver -- queries --&gt; root nameserver 5. Resolver -- queries --&gt; `.com` nameserver | . What is the root nameserver? | When a client begins to resolve a DNS query, the remote resolution process starts with a request to a root nameserver. It will respond with a referral to further authoritative servers. A root nameserver is a type of authoritative nameserver. Another type of authoritative nameserver is a **TLD nameserver**. For example, the request to translate `www.wikipedia.org` will receive a response containing addresses of `.org` authoritative TLD server servers. Ao | . How can performance be increased? | The are DNS caching servers which store resolved mappings for a specified period. This reduces DNS traffic across the internet. How long cache entries are stored is according to the TTL value for the DNS record in question. | . What are the various DNS records for? | Besives translating names to IP addresses, DNS can instruct mail agents which is the best mail server to deliver email. An MX record provides a mapping between a domain a mail exchanges. | . Question? | Answer | .",
            "url": "https://words.howapped.com/cornell%20explainers/networking%20for%20devs/2022/03/09/dns-for-developers.html",
            "relUrl": "/cornell%20explainers/networking%20for%20devs/2022/03/09/dns-for-developers.html",
            "date": " â€¢ Mar 9, 2022"
        }
        
    
  
    
        ,"post2": {
            "title": "This Year I Learned",
            "content": ". Hereâ€™s a roundup of my professional learnings from the year. . The sections for 2022 goals are limited in scope on account of recently giving birth to our second child :) . Professional . Always be Quitting . Thanks to Julio Merino for the phrase and his excellent article. . The phrase describes how we should approach a software project, as participants, owners and stewards. We should be in a permanent state of being able to handover the project. . It does not mean, abdicating responsbility. . It means encouraging transparency by promoting documentation as you develop. So that at any one time, A project and user can be onboarded or the project can be demoed. As well as the software itself, this also includes documenting your long-term plans for the project. . It means, eliminating, what Google refer to as The Bus Factor. The act of sharing knowledge so no one individual is a silo or bottleneck. This is covered extensively in Oâ€™Reillyâ€™s excellent book, Software Engineering at Google. . It means, looking to move on from a project as a positive, rather than a negative move. This can mean sharing your knowledge by training others around you and to identify and train your replacement. When the time is right, this leaves you to focus your efforts on kickstarting new projects. . Resources . Julio Merino - Always Be Quitting https://jmmv.dev/2021/04/always-be-quitting.html | . | . Using a design document to explain and persuade. . This year Iâ€™ve found using a platform like Confluence to create a design document has helped to explain and persuade an approach or design strategy. . This is especially true when time pressures have meant face-to-face, synchronous communications have been harder to come by. . 2021 has been a very active year in the hiring market. A shift to permanent work-from-home has contributed to The Great Resignation. . On my own team, we saw quite a radical shift in headcount and time for meetings and proposals has often been cut short as resources are stretched. For a more asynchronous working approach, itâ€™s useful to make a write up with the problem statement and the various approaches available. . Let your audience understand the various Bronze, Silver and Gold approaches to solving a problem, with its tradeoffs and costs. Subsequently, a team can make a considered judgement in a way thatâ€™s been documented for posterity. Further discussion takes place in the page comments rather than taking place on a call, or buried in a ticket. . Resources . Chapter 10 - Design Docs - Sofware Engineering at Google https://learning.oreilly.com/library/view/software-engineering-at/9781492082781/ch10.html#design_docs | . | . Development using Static Code Analysis for quicker feedback loops . In 2021 I dabbled with Rust. Itâ€™s my first dive into high-level, compiled languages since my days of C++ and Java at the start of my career. . Itâ€™s worth saying, the tooling around Rust development is first-class and it showed how the compiler is able to present the developer with errors at an early stage so that you fail fast. . In a work project, we also used the Typescript template with Create-React-App. . Using both of these opened my eyes to how the compilation step and static code analysis can help the developer find bugs, antipatterns and other issues at the coding stage of the Software Development Lifecycle without running the program. . Subsequently, in my daily Python-land, this led me to use mypy and Pythonâ€™s â€˜opt-inâ€™ typing mechanism more thoroughly. . Resources . Rust Book . https://learning.oreilly.com/library/view/programming-rust-2nd/9781492052586/ | . | Rustlings . https://github.com/rust-lang/rustlings | . | React Typescript cheatsheet . https://react-typescript-cheatsheet.netlify.app/docs/basic/setup/ | . | Full-Stack React, Typescript and Node . https://learning.oreilly.com/library/view/full-stack-react-typescript/9781839219931/ | . | . Efficient learning using a variety of senses . As mentioned above, I was curious about Rust. . From my learnings, it appears that Rust is a high level language that repeatedly appears as a winner in the Stack Overflow Developer survey as the most-loved language. I needed to see what the fuss was all about. . I was curious to see how a high-level systems language compares to Python in terms in memory footprint and performance in general. . Instead of just linearly reading the official Rust book and doing exercies, I used the excellent Rustlings repository which has the user authoring actual rust code samples, correcting the logic and syntax to pass a unit test, and then running the the test suite to ensure it passes. . By not only reading, but interactively coding with what Iâ€™d learnt from the rust book, I was putting knowledge acquired to the test. By using different learning methods, with different media, this helps the brain with retention. . Resources . Rust Book . https://learning.oreilly.com/library/view/programming-rust-2nd/9781492052586/ | . | Rustlings . https://github.com/rust-lang/rustlings | . | . Post-Pandemic remote teamwork: Do not rely on Jira alone for communication . In 2021 Iâ€™ve been involved in consulting for a single software team where weâ€™ve delivered on a couple of data-driven software projects. . I consider this team highly productive and efficient in meeting its bi-weekly sprint goals. One of its strengths has been how we communicate. That is, to use Jira for ticketing, as a documentation tool, rather than a communication tool. . Itâ€™s quite easy to fall into the trap of making Jira comments, tagging other team members and then relying on this for inter-team communication. . In a remote-first working world, where an asynchronous communication style takes priority, we cannot rely solely that intended recipients will have digested the Jira notifications. Communications should be reinforced with a quick ping on instant message or voice call. . The sheer barrage of notifications (Jira or other platform) will mean your crafted comment or code review note may get buried in the noise. Use a more immediate communication method if applicable. . Tools and Libraries: FastAPI, Pydantic, React Context API, Mongo Aggregation Framework . In Python, 2021 Iâ€™ve gotten to grips with FastAPI and Pydantic which has greatly helped with rapid application development. . FastAPI is an async micro web framework that works beautifully with Pydantic and works with the OpenAPI protocol to produce beauiful API documentation out of the box. This is exactly what our team needed in order to move quickly. . 2022 Professional Goals . Write a Rust crate | Run mypy constantly during development to flag typing errors in Python code as they appear, rather than solely as a pre-commit hook | . Personal . Lesser Minds, the importance of engaging with strangers . In 2021 I read a very memorable book, The Power Of Strangers .",
            "url": "https://words.howapped.com/year-in-review/2021/12/30/learnings-from-the-year-2021.html",
            "relUrl": "/year-in-review/2021/12/30/learnings-from-the-year-2021.html",
            "date": " â€¢ Dec 30, 2021"
        }
        
    
  
    
        ,"post3": {
            "title": "Effective Engineering Management",
            "content": "As we know Software Development is not just about technical problem solving, but the human factors involved when delivering a product at scale. . From an essay in Software Engineering at Google, Brian Fitzpatrick discusses engineering management patterns and anti-patterns. At itâ€™s core are the values of Trust, Humility and Respect. . Iâ€™ve analysed and summarised below. . Donâ€™t: Hire Pushovers . This means hiring people that are smarter than you and could eventually replace you. . When leading a team or as indivividual contributor, our general strategy should be â€˜We may leave at any time, so have the project and processes in a state where they are documented and can be handed over. . At first, the statement above may sound negative. But this approach means you and everyone around you progress on to new projects and opportunities. . Donâ€™t: Ignore Low performers . The team suffers if there is a team member who isnâ€™t doing their best and you donâ€™t address it. . Keeping a low achiever in your team keeps high performers from joining and encourages existing high performers to leave. . Instead, help the strugglers up, or out. . Donâ€™t: Ignore Human Issues . Focusing all your energies on technical problem solving can mean youâ€™ve neglected colleaguesâ€™ personal poblems. This sows discontent, leading to a lack of team productivity. . Donâ€™t: Be everyoneâ€™s friend . Becoming a manager or team lead of colleagues where previously you were peers may be uncomfortable at first. . Having a weekly team lunch can be an effective way to remain socially connected without making them uncomfortable. . Donâ€™t: Compromise the hiring bar. . This can happen when you need to hire quickly, the legendary Blitzscale! Donâ€™t be tempted. . Donâ€™t sacrifice the hiring standard because, the cost of hiring the appropriate person pales compared to dealing with a bad hire. . In the words of Steve Jobs, A people hire other A people. B people hire C people. . Donâ€™t: Treat your team like children . Trust them to be great, and they will be great. . Give them opportunity to be responsible for their work. . Do: Lose the Ego . This means trusting your team by respecting the abilities and prior accomplishments of team members. . Help to set goals and reach consensus but the details of how to reach them are best decided by the people putting the product together. . This gives the team a better sense of accountability, ownership and responsibility. . This also means accepting criticism openly and avoiding the urge to be territorial. . Do: Be a zen master . Control your emotions and reactions, because a leader is always on stage and your team is always conciously and unconsciously looking to you for cues on how to react. . This can mean keeping your cynicsm to yourself. . Asking questions is a great way to instill humility, respect and trust because itâ€™s helps the other person problem solve on their own by trying to define and explore the problem. . Do: Be a catalyst . Encourage democracy rather than a dictatorship by building consensus. This can either mean guiding the process from start to finish, or just giving it a gentle nudge in the right direction. . Do: Remove roadblocks . Help the team overcome technical or organisational hurdles to get it moving again. Often this means contacting the appropriate team for getting access to particular infrastructure. . Do: Be a mentor/teacher . Whether you like it or not, a team leader will end up guiding a more junior team member through; code, technology or architectural concept or team culture. . For this you need: . Experience with your teamâ€™s processes and systems. | The ability to explain things to someone else. | The ability to guage how much help your mentee needs. | The last point is key because you donâ€™t want to be overexplaining since the mentee will just tune you out. . Do: Set clear goals . You need to define a concise team mission statement to ensure your team is aligned about the direction in which itâ€™s heading. . Then â€¦ . Step back and give it more autonomy and periodically checking in to make sure everyone is still on the right track. . This drastically improves the efficiency of your team because no energy is wasted where individuals can pull the product in slightly different directions. . Do: Be Honest . Thereâ€™s the need for supreme honesty when giving direct feedback. Avoid the compliment sandwich since this can deflect attention from the issue that requires change or improvement. . When giving critism, delivery is key to making sure the message is heard. Avoid sugarcoating. . Kindness and empathy is critical. . Do: Track Happiness . To stave off discontent, here are some ideas: . At the end of a weekly one-on-one, ask â€œWhat do you needâ€ . | Make sure people get recognition for their work by tracking the mundane tasks and distributing responsibilities evenly. . | To prevent burnout, track hours and exchange them for fun team activities. . | . Conclusion . Ultimately, you need to be an enabler and plan how you are going to help your team members realise their career wishes and desires. This might be with opportunities to improve themselves or be recognised for the work they do. . . Please buy! I thoroughly recommend. . You may buy Software Engineering at Google here. . Bookshop.org | . .",
            "url": "https://words.howapped.com/book%20notes/work%20life/non-fiction/2021/09/15/team-leading-dos-and-donts.html",
            "relUrl": "/book%20notes/work%20life/non-fiction/2021/09/15/team-leading-dos-and-donts.html",
            "date": " â€¢ Sep 15, 2021"
        }
        
    
  
    
        ,"post4": {
            "title": "Book Notes - No Rules Rules",
            "content": "As soon as I saw the title, I knew this is a book I had to read. . NO RULES RULES . NETFLIX and the Culture of Reinvention . REED HASTINGS . ERIN MEYER . There are 10 chapters which cover the creative workplace culture of Netflix - the highly succesful streaming and film production company. . After having worked in various levels of progressive workplace culture at small and large companies, this book really connected the dots for me. . Here are my notes transferred from my Remarkable tablet (which Iâ€™ve fallen in love with) . 1. First, build up talent density . Your number one goal as leader is to develop a work environment consisting of stunning colleagues | Stunning colleagues accomplish significant amounts of important work and are exceptionally creative and passionate | Jerks, slackers and sweet people with non stellar performance or pessimists on the team will bring down the performance of everyone | . 2. Say what you really think (with positive intent) . With candour, high performers will become outstanding performers . Frequent candid feedback exponentially magnifies the speed and effectiveness of your work force . | Set the stage for candour by building feedback moments into your regular meetings | Coach your employees to give and receive feedback effectively following the 4A guidelines (live) (Give) ) Aim to Assist (Giving) | Actionable (Giving) | Appreciate (Receiving) | Accept or Discard (Receiving) | . | As a leader solicit feedback regularly and respond with belonging cues when you receive | Get rid of jerks as you instill a culture of candour | . 3a. Remove Vacation Policy . If you arenâ€™t tracking worked in a day, what is the point tracking days per year? | Leaders must model big-vacation taking to set example and precedent to guide employee behaviour | Explain there is no need to ask for prior approval and no one is expected to keep track of days away from the office | Up to employee to take few hours, days, a week, a month off. | Communicate to provide context | . 3b. Remove travel and expense approvals . Remove, and encourage managers to set context about how to spend money up front, and check expenses at the back end. If people overspend, set more context | No expense controls mean finance departments must audit annually | Fire people that abuse the system but speak about the abuse opening so everyone knows repercussions | Costs from overspending arenâ€™t nearly as high as the gains that freedom provides because employees are able to make quick decisions to spend money to help the business. | When you tell people you trust them, they will show you how trustworthy they are | . 4. Pay top of personal market . The methods used by most companies to compensate employees are not ideal for a creative high- talent density workforce | Divide your workforce â€˜into creative and operational. and pay creative workers top of market. This might mean hiring one exceptional instead of 10 adequate people | Donâ€™t pay performance-related bonuses and put into salary instead | Teach employees to build their own networks and to invest time getting to know their own - and their teamsâ€™ - market value on an on- going bases Adjust salaries accordingly | . 5. Open the books . A culture of transparency: No closed offices or assistants as guards | Open up books to employees and show how to read Pth accounts. Share sensitive financials | Desicions the might affect workforce well-being be opened up early. May cause anxiety but will create trust (which is more valuable) | If the transparency is at loggerheads with an individualâ€™s privacy - of info is from a work circumstance, be candid but if not, say itâ€™s not your place to share | If youâ€™ve shown yourself to be competent, be open about your own mistakes to increase trust, goodwill, innovation | . 6. No decision-making approvals needed . In a fast, innovative company ownership of big - ticket decision should be dispersed across workforce at different levels, not according hierarchical status. | Netflix mantra and the bookâ€™s main jacket quote: â€œDonâ€™t seek to please your bossâ€ | When employees join company, tell them they have a handful of metaphorical chips to make bets with. A workers performance is judged on collective outcome of these bets | To help good bets encourage staff to farm for dissent socialize the idea and test out the big bets. Teach that if a bet fails it should be â€˜sunshinedâ€™ openly sharing learnings etc | . 7. The keeper Test . Encourage managers to be tough on performance by asking which of my people, if they told me they were leaving for a similar role, would I fight to keep?â€™ | Avoid stack-ranking as they create internal competition. and discourage collaboration | â€˜Familyâ€™ metaphor for workforce isnâ€™t as good as â€˜Professional Sports Teamâ€™ Teach to instill feelings of . commitment, cohesion , camaraderie | When you realize you need to let someone go, a personal improvement plan is humiliating and costly. Instead use money for a generous severance | Employees may have fear that their job is on the line, so employees should ask their manager to ask â€˜If I was thinking of leaving, how hard would you work to change my mindâ€™ | When an employee is let go, Speak openly and answer questions candidly. This will diminish their fear of being next and increase trust | . 8. Max up candour: A circle of trust . A thorough live 360/ feedback session every 6- 12 months ensures clear feedback | Performance reviews arenâ€™t the best mechanism as can be one -sided and limited to just one person (employee boys | A 360 written report is good for annual feedback but donâ€™t link to promotions | Use 4A feeback guidelines for live 360 dinners and start, stop, continue method with roughly 25% positive, 75% development with an actionable (no fluff) | . 9. Lead with context, not control . The overall goal should be innovation (not error prevention) and operate in a loosely coupled System | To lead with context, you need a high talent density. After this get in lockstep alignment by providing and debating context to enable sound decision - making | If a poor decision has been made, donâ€™t blame. Ask what context you failed to communicate. | Is everyone highly aligned on vision and objectives ? | A loosely coupled organisation should resemble a tree rather than a pyramid. The boss is at the roots, holding up the trunk of senior managers who support the outer branches where decisions are made. | These policies, Reed argues do not work for Netflix/a creative engineering culture. Vacation Policies | Decision- Making approvals | Expense Policies | Performance Improvement Glans | Approval Processes | Raise Pools | Key Performance Indicators | Management by Objective | Travel Policies | Decision - Making by Committee | Contract Sign offs | ay- Grades | Pay- per performance Bonuses | . | . 10. Going Global . Map out corporate culture and compare to the culture you are expanding into | In less direct countries, implement more formal feedback mechanisms. | Encourage adaptability. Discuss openly what candour means in different parts of world. Work together to adapt | .",
            "url": "https://words.howapped.com/book%20notes/work%20life/non-fiction/2021/02/07/book-notes-no-rules-rules-netflix.html",
            "relUrl": "/book%20notes/work%20life/non-fiction/2021/02/07/book-notes-no-rules-rules-netflix.html",
            "date": " â€¢ Feb 7, 2021"
        }
        
    
  
    
        ,"post5": {
            "title": "AWS Certified Solutions Architect - Exam Differences",
            "content": "AWS have released an update on their most popular and wide-ranging certification course. . The software architect exam at associate level SAA-C01 has been retired and SAA-C02 takes its place. . October 2020 Update: I passed! . Commenters with experience of the two will maintain that as long as you keep to the fundamentals of the 5 pillars of the well-architected framework, the two exams have mostly the same content. . It pays to be aware of the new products AWS offer. We know that being able to leverage natively provided technologies from a cloud provider will often present efficiency gains in the Software Development Lifecycle. . In the SAA-C02 exam, the new technologies we should be aware of: . Name Â  . AWS Global Accelerator | Â  | Â  | Â  | . Elastic Fabric Adapter | Â  | Â  | Â  | . Elastic Network Adapter | Â  | Â  | Â  | . AWS Parallel Cluster | Â  | Â  | Â  | . Amazon FSx | Â  | Â  | Â  | . AWS DataSync | Â  | Â  | Â  | . AWS Directory Service | Â  | Â  | Â  | . High Performance Computing | Â  | Â  | Â  | . Aurora Serverless | Â  | Â  | Â  | .",
            "url": "https://words.howapped.com/aws/2020/07/28/AWS-architect-exam-differences.html",
            "relUrl": "/aws/2020/07/28/AWS-architect-exam-differences.html",
            "date": " â€¢ Jul 28, 2020"
        }
        
    
  
    
        ,"post6": {
            "title": "Computers are fast - A cheatsheet",
            "content": "This is inspired by Julia Evans and Kamal Marhubiâ€™s excellent mini-quiz on the data rates of systems and components. . The below cheatsheet serves as a summary of those benchmark speeds, for at-a-glance consumption. . Orders of magnitude . The idea is not necessarily know the exact figures for a particular benchmark, just the right order of magnitude. . ğŸŒ 100 1 . ğŸ¦¥ 101 10 . ğŸš¶ 102 100 . ğŸƒâ€â™€ï¸ 103 1,000 . ğŸ‡â€ 104 10,000 . â€ğŸï¸ğŸ’¨ 105 100,000 . ğŸš 106 1,000,000 . âœˆï¸ 107 10,000,000 . ğŸš€ 108 100,000,000 . ğŸŒ  109 1,000,000,000 . â€˜How much can be done in a secondâ€™ . sum.c . Each loop adds to total | How many loop iterations per second? ğŸš€ - ğŸŒ  | Between 100 million and 1 Billion | 108 &gt; and &lt; 109 | . | . loop.py . Empty loop contents | How many loop iterations per second? âœˆï¸ - ğŸš€ | Between 10m and 100m | 107 &gt; and &lt; 108 | . | . dict.py . Add elements to a fixed-size dictionary | How many loop iterations per second? âœˆï¸ - ğŸš€ | Between 10m and 100m | 104 &gt; and &lt; 105 | . | . parse_http_request.py . Using Python built-in HTTP request parser | How many HTTP requests parsed per second? ğŸ‡â€ï¸ - â€ğŸï¸ğŸ’¨â€ | Between 10,000 and 100,000 | 104 &gt; and &lt; 105 | . | . download_webpage.py . Downloading with urllib2 | How many HTTP requests completed per second? ğŸŒâ€ï¸ - â€ğŸ¦¥ | Between 1 and 10 | The true cost depends on size, connection speed and distance from servers . | . | . run_python.sh . Running Python script(s) from bash | Bash loop iterations per second ğŸ¦¥ - â€ğŸš¶â€ | Between 10 and 100 | 101 &gt; and &lt; 102 | . | . write_to_disk.py . Code run on a machine with an SSD | How many bytes written to disk in a second ğŸš€ - ğŸŒ  | Between 100 million and 1 Billion | . | How many megabytes written to disk in a second ğŸš¶ - ğŸƒâ€â™€ï¸ | Between 100 and 1,000 | My T480s running Ubuntu with SSD reports write speed: 2.3 GB/s and read 673 MB/s 1 | . | . write_to_memory.py . How many bytes written to a string in memory in a second ğŸŒ + | Above 1 Billion | . | . grep_bytes.sh . Bytes search in a second ğŸŒ + | Above 1 Billion | . | . find-filenames.sh . Files come from the filesystem cache | How many files listed in one second? ğŸğŸ’¨ - â€ğŸš | Between 100,000 and 1m | 105 &gt; and &lt; 106 | Grep can search at 2GB/s so more limited by disk speed than grepâ€™s speed . | . | . json_parse.py . Deserializing the same 65k of JSON repeatedly | How many loop iterations in a second? ğŸš¶ - â€ğŸƒâ€â™€ï¸ | Between 100 and 1,000 | 102 &gt; and &lt; 103 | . | . msgpack_parse.py . Parse 46k of msgpack data | How many loop iterations in a second? ğŸƒâ€â™€ï¸ - â€ğŸ‡â€ | Between 1,000 and 10,000 | 103 &gt; and &lt; 104 | Your choice of format and deserialisation library (eg capnproto) makes a big difference . | . | . database_indexed.py . Select one row from an indexed sqlite table containing 10m rows | How many queries in one second â€ğŸ‡â€ - ğŸï¸ğŸ’¨ | Between 10,000 and 100,000 | 104 &gt; and &lt; 105 | Typical query in 20 microseconds | . | . database_unindexed.py . Select one row from an unindexed sqlite table containing 10m rows | How many queries in one second ğŸŒâ€ï¸ - â€ğŸ¦¥ | Between 1 and 10 | 100 &gt; and &lt; 101 | . | . hash.py . How many bytes hashed in one second? ğŸš€ - ğŸŒ  | Between 100 million and 1 Billion | 108 &gt; and &lt; 109 | MD5 is designed to be fast . | . | . bcrypt_hash.py . Number of passwords hashed in a second? ğŸŒâ€ï¸ - â€ğŸ¦¥ | Between 1 and 10 | 100 &gt; and &lt; 101 | . | . fill_array.c . Memory is accessed sequentially from a CPU cache | Number of passwords hashed in a second? ğŸš€ - ğŸŒ  | Between 100 million and 1 Billion | 108 &gt; and &lt; 109 | . | . fill_array.c . Number of passwords hashed in a second? âœˆï¸ - ğŸš€ | Between 10m and 100m | 104 &gt; and &lt; 105 | . | . Resources used: with thanks ğŸ’š . Do you know how much your computer can do in a second? - Mini Quiz | . https://www.binarytides.com/linux-test-drive-speed/Â &#8617; . |",
            "url": "https://words.howapped.com/cheatsheet/python%20performance/2020/07/23/computers-are-fast-cheatsheet.html",
            "relUrl": "/cheatsheet/python%20performance/2020/07/23/computers-are-fast-cheatsheet.html",
            "date": " â€¢ Jul 23, 2020"
        }
        
    
  
    
        ,"post7": {
            "title": "Book Notes - Managing Humans",
            "content": "I (Jon) have recently finished this book about management and leadership. It does a great job in explaining empathy, archetypes and â€˜general craziness of dysfunctional bright peopleâ€™ with plenty of pertinent and amusing anecodotes. . Itâ€™s written for aspiring and current managers and at 3rd edition, Michael writes as though he knows his audience well. He has clearly trodden the boards, delivered software projects, and led teams at Borland and Apple. . My rating: 4/5 . Chapter Notes . CH4 - Rands Test . Where the â€˜Joel testâ€™ can be an effective way to get a health check on a software team, the Rands test does the same for general team fitness in the context of management. . A score of 10 or lower - â€˜youâ€™ve got serious problemsâ€™ . Do you have consistent one-on-ones, about topics other than status? (+1) | Do you have consistent team meetings? (+1) | Are handwritten status reports delivered weekly via email? (-1) | Are you comfortable saying â€˜noâ€™ to your boss? (+1) | Can you explain the strategy of your company to a stranger? (+1) | Can you explain current health of the business? (+1) | Is there a regular stand-up by the person in charge? Do you buy it? (+1) | Do you know what you want to do next? (+1) Does your boss? (+1) | Do you have time to be strategic? (+1) | Are you actively killing the grapevine? ie. Do you make a point to kill gossip? (+1) | . CH39 - Incrementalist vs. Realists . Incrementalists and Realists donâ€™t disagree about whether or not we should do something about the problem. We are disagreeing about how much we should do. â€¦ There are two distinct personalities when it comes to devising solutions. . Incrementalists are realists and they have a pretty good idea of what is achievable given a problem to solve, a product to ship. â€¦ They tend to know all the secrets. . Completionists are dreamers. Their mantra is â€œIf youâ€™re going to spend the time given to solve a problem, solve it in a manner so you arenâ€™t going to be solving it again in 3 monthsâ€ . Incrementalists need vision and are driven by the goal of progress and constantly moving forward. . Completionists can often see the immediate solution, and the two-year solution and the five-year solution. . CH40 - Organics and Mechanics . The chapter covers how to speak to your manager and to identify if they are one of two personalities and the interpersonal conflict that may arise between the two. Lopp comments that the ensuing â€˜organisational warfareâ€™ is a waste of time (and money) as it focuses everyone on the peculiar personality quirks of the other rather than on the business. . Mechanics move forward methodically. They carefully gather information in a structured manner. They quietly observe and are comfortable predictable. They annoy the hell out of the organics . Organics are all over the place. They tend to be loud and can tell a joke. They ask seemingly meaningless questions. . Mechanic: â€œThis guy is walking chaosâ€Organic: â€œThis guy is totally uptightâ€ . CH52 - Chaotic, Beautiful snowflakes . Engineers have a well-deserved reputation for regularly being off by a factor of three in their work estimates, partly due to the fact that we are really shitty at estimating the no-linear chaotic work that exists in keeping a group of humans pointed in the right direction. . Michaelâ€™s parting thought . The hard work of great leadership isnâ€™t just managing the expected tasks that we can predict - itâ€™s the art of successfully traversing the unexpected. .",
            "url": "https://words.howapped.com/book%20notes/work%20life/non-fiction/2020/07/19/book-notes-managing-humans.html",
            "relUrl": "/book%20notes/work%20life/non-fiction/2020/07/19/book-notes-managing-humans.html",
            "date": " â€¢ Jul 19, 2020"
        }
        
    
  
    
        ,"post8": {
            "title": "Scheduled Severless Startup",
            "content": "The Problem . As part of the early Covid-19 response, Digital Ocean donated some free credit to us to host an app for a local food delivery scheme. . To make that credit go as far as possible and to minimise power consumption, we&#39;d like to power up and down the servers according to a schedule. . The Solution . Here&#39;s how to do that with AWS Lambda, with cloudfront events. We iterate on that to use the Serverless Framework. . TLDR; Have a look at the companion repo.. It contains an example dockerized web app and the shell scripts for starting containers and creating the service. . This article covers how to automate with a Digital Ocean droplet so to follow along with the code, you can create one using the example from a previous article. . We will examine the cURL statements, convert those into Python. We can use AWS Lambda to execute the Python in a serverless environment. Then, the AWS lambda functions can be triggered by Cloudwatch events to a schedule so machines can be brought online only during operating hours. . We can notify any interested parties using Microsoft Teams - a topic for a subsequent post. . Prerequisites . You can always check the companion repo. . You will need to: . .. have jq installed to format JSON responses Download JQ for your OS | . | . .. have a server on which a dockerized web app will start automatically when the server is restarted See previous article on how to create one with DigitalOcean. | . | . .. have installed Boto3 with your AWS account credentials so we can work with the AWS Python SDK. | . cURL statements to boot down and up . As covered in a previous post, our web app will restart when rebooted using a systemd service. . Rather than ssh or the cloud provider&#39;s control panel, the server can be started and stopped using cURL. . In the case of DigitalOcean: . Find out the ID of the server: . $ curl -H &#39;Content-Type: application/json&#39; -H &#39;Authorization: Bearer &#39;$DIGITAL_OCEAN_ACCESS_TOKEN&#39;&#39; &quot;https://api.digitalocean.com/v2/droplets?name=scheduled-serverless&quot; | jq &#39;.droplets[] | {id:.id, name:.name, status: .status}&#39; . The output gives us the ID . { ... }, { &quot;id&quot;: 195786885, &quot;name&quot;: &quot;scheduled-serverless&quot;, &quot;status&quot;: &quot;active&quot; } . And then power it down: . $ curl -X POST -H &#39;Content-Type: application/json&#39; -H &#39;Authorization: Bearer &#39;$DIGITAL_OCEAN_ACCESS_TOKEN&#39;&#39; -d &#39;{&quot;type&quot;:&quot;power_off&quot;}&#39; &quot;https://api.digitalocean.com/v2/droplets/195786885/actions&quot; | jq &#39;.[] | {id:.id, status:.status, type:.type}&#39; . Which tells us it&#39;s in progress . { &quot;id&quot;: 955320153, &quot;status&quot;: &quot;in-progress&quot;, &quot;type&quot;: &quot;power_off&quot; } . The equivalent cURL for powering on the server is virtual identical . $ curl -X POST -H &#39;Content-Type: application/json&#39; -H &#39;Authorization: Bearer &#39;$DIGITAL_OCEAN_ACCESS_TOKEN&#39;&#39; -d &#39;{&quot;type&quot;:&quot;power_on&quot;}&#39; &quot;https://api.digitalocean.com/v2/droplets/195786885/actions&quot; | jq &#39;.[] | {id:.id, status:.status, type:.type}&#39; . The web app from the example is running on port 80. We know the server&#39;s IP address by referring to the control panel. Let&#39;s confirm that the service is running by verifying the output in a browser. . . Requests scripts in AWS Lambda . The cURL statements in Python . First, get the ID of the droplet. . import os import sys import requests TOKEN = os.getenv(&#39;DIGITAL_OCEAN_ACCESS_TOKEN&#39;,&#39;&#39;) DROPLET_NAME = &#39;scheduled-serverless&#39; headers = { &#39;Content-Type&#39;: &#39;application/json&#39;, &#39;Authorization&#39;: f&#39;Bearer {TOKEN}&#39;, } if TOKEN == &#39;&#39;: sys.exit(&#39;Your environment should have the `DIGITAL_OCEAN_ACCESS_TOKEN exported.&#39;) def get_droplet(): response = requests.get(&#39;https://api.digitalocean.com/v2/droplets&#39;, headers=headers, params={}) return [d for d in response.json().get(&#39;droplets&#39;,{}) if d.get(&#39;name&#39;,&#39;&#39;) == DROPLET_NAME][0] DROPLET = get_droplet() print(f&#39;Droplet ID: {DROPLET.get(&quot;id&quot;)}&#39;) . Droplet ID: 195786885 . Now we have the ID, let&#39;s define the functions for bringing the servers down and back up. . def power_off() -&gt; dict: data = &#39;{&quot;type&quot;:&quot;power_off&quot;}&#39; url = f&#39;https://api.digitalocean.com/v2/droplets/{DROPLET.get(&quot;id&quot;)}/actions&#39; response = requests.post(url, headers=headers, data=data) return response.json() def power_on() -&gt; dict: data = &#39;{&quot;type&quot;:&quot;power_on&quot;}&#39; url = f&#39;https://api.digitalocean.com/v2/droplets/{DROPLET.get(&quot;id&quot;)}/actions&#39; response = requests.post(url, headers=headers, data=data) return response.json() action_resp = power_off() print(action_resp[&#39;action&#39;][&#39;type&#39;]) print(action_resp[&#39;action&#39;][&#39;status&#39;]) print(&#39;-&#39;) # action_resp = power_on() # print(action_resp[&#39;action&#39;][&#39;type&#39;]) # print(action_resp[&#39;action&#39;][&#39;status&#39;]) . power_off in-progress - . Running the scripts in AWS Lambda . Let&#39;s translate the cURL statements into Python. . # Popping on a new on/off timestamp on a firebase stored stack import requests import arrow start: dict = {&#39;off&#39;: [&#39;2020-08-11 09:04&#39;], &#39;on&#39;: [&#39;2020-08-11 09:03&#39;]} # get data url = &#39;https://wordsdothowappeddotcom.firebaseio.com/scheduled-serverless-startup.json?print=pretty&#39; r = requests.get(url, data={}, headers={},) data = r.json() print(data) # replace data print(data[&#39;off&#39;][0]) . ModuleNotFoundError Traceback (most recent call last) In [12]: Line 4: import arrow ModuleNotFoundError: No module named &#39;arrow&#39; . Schedule the scripts with Cloudwatch events . Putting it all together in a Serverless Application Framework template . Quality of Life enhancements . When the target service is unavailable, it&#39;s quite unfriendly to show a blank 500 screen. A subsequent post outlines a solution for a forwarding service which can display an Open/Closed for business page to the user, with &#39;Opening times&#39; . As part of what&#39;s become known as &#39;Chatops&#39;, it&#39;s useful to update team members and stakeholders about the status of the server. A future addition will be to use the Microsoft Teams API to notify interested parties. . Resources used: with thanks &#128154; . Curl converter Github repo | . AWS Lambda and Secret Management Overview Blog post from Espagon . | Sharing Secrets with AWS Lambda Using AWS Systems Manager Parameter Store AWS Compute blog post . | .",
            "url": "https://words.howapped.com/aws%20lambda/automation/python/2020/07/15/scheduled-serverless-startup.html",
            "relUrl": "/aws%20lambda/automation/python/2020/07/15/scheduled-serverless-startup.html",
            "date": " â€¢ Jul 15, 2020"
        }
        
    
  
    
        ,"post9": {
            "title": "hello world serverless microservice",
            "content": "Problem . We&#39;ve been asked for an API that will work at web scale and be cost effective. A serverless API is perfect for this. . What are the constituent parts needed to start working with the AWS SDK with Python and steps needed to write and execute a serverless script with AWS Lambda. How can this script be invoked by an HTTP endpoint? . Solution . The companion repo consists utility code for deploying the lambda with boto3 as well as detail on the AWS API Gateway service that provides an endpoint to invoke the serverless function. . This is the end product; A serverless endpoint. . . The code can be found on Github.. . Once cloned, install dependencies, set your AWS account ID as an environment variable and run it. . (venv) (base) $ python src/main.py âœ… Remove existing named lambda/api âœ… Create the lambda âœ… Deploy the lambda âœ… Remove any existing API âœ… Create API âœ… Deploy API âœ… Test API SERVERLESS ENDPOINT RESPONSE from https://qvaik2un06.execute-api.eu-west-2.amazonaws.com/hello-world : b&#39;{&quot;querystring_params:&quot;: {}, &quot;err&quot;: null, &quot;message&quot;: &quot;Hello Serverless World&quot;}&#39; . Setup: Creating the Lambda function and deploying . Python module structure . Like this . lambdapi â”œâ”€â”€ src â”‚ â”œâ”€â”€ __init__.py â”‚ â”œâ”€â”€ settings.py # constants like AWS account â”‚ â”œâ”€â”€ main.py # run me for instant results | â””â”€â”€â”€ python_lambdas | | â””â”€â”€â”€ hello_world.py # serverless python function â”‚ â”œâ”€â”€ api_gateway.py # boto3 for api_gateway â”‚ â”œâ”€â”€ lambda_functions.py # boto3 lambda â”‚ â””â”€â”€ helpers.py # file operations â””â”€â”€ ... . AWS Permissions with IAM . IAM Resources used - policies and roles. . IAM Policies define the effect, actions, resources and optional conditions in a JSON document. . An IAM user is a person or service that interacts with AWS with their own access to the management console. A user can have a policy attached to them. In this case it is more appropriate to grant policy access with an IAM role. When assuming an IAM role (see Trusted Entity), access to a service can be granted to a user without having to give them new keys as the user can use temporary security tokens. . Create an IAM Lambda access policy for IAM using an IAM client that you create. . The access definition is provided in an s3_access_policy_document . JSON dictionary | Action key Statement with all S3 permissions | Cloudwatch to create log groups and streams for monitoring of the lamdba events | . | . After creating a policy, create role and attach it to an execution role by assuming the role. . Verifying the Lambda was created on AWS Console . By way of sanity check, we can verify the Lambda function has been uploaded in the AWS Console. . For the appropriate region, you may see the function, memory, timeout and our chosen permissions. . . ## Testing the endpoint ## Parting Note This brief walkthrough essentially achieves the same solution as the AWS Serverless Application model &#39;Hello World&#39; tutorial. . Alternative Solution . The AWS Serverless Application Model is a framework that allows you to build and deploy serverless applications. . You may declare the lambda functions to be used and additional resources like APIs and database in a YAML template. It uses an implementation of AWS CloudFormation to define these resources provides myriad other benefits. . The AWS Hello World SAM tutorial covers what we outlined manually above and also shows how to run the Lambda and API route locally and remove the CloudFormation stack to clean up. . However, when dissecting software to understand a technique, it&#39;s always useful to strip away layers of abstraction. . . Resources used: with thanks &#128154; . Niyazi Erdogan&#39;s O&#39;Reilly course - Build and Deploy Lambda functions AWS and Python Videos . | Building Lambda Functions with Python AWS docs . | boto3 AWS Python SDK lambda docs | AWS Lambda Execution role | Using AWS Lambda with Amazon API Gateway AWS Tutorial | Setting up API Gateway and integrating it with Lambda proxy in Richard T. Freeman&#39;s serverless microservice course O&#39;Reilly Videos | AWS SAM Hello World Tutorial - AWS Docs | .",
            "url": "https://words.howapped.com/aws%20lambda/boto3/python/aws%20api%20gateway/2020/07/01/serverless-endpoint-with-aws-lambda-api-gateway-and-boto3.html",
            "relUrl": "/aws%20lambda/boto3/python/aws%20api%20gateway/2020/07/01/serverless-endpoint-with-aws-lambda-api-gateway-and-boto3.html",
            "date": " â€¢ Jul 1, 2020"
        }
        
    
  
    
        ,"post10": {
            "title": "Scheduled Severless Startup",
            "content": "The Problem . As part of the Covid-19 effort, Digital Ocean donated some free credit to us to work on a local food delivery scheme. . To make that credit go as far as possible and to minimise power consumption, we&#39;d like to power up and down the servers according to a schedule. . The Solution . Esimated cost saving... . Here&#39;s how to do that with AWS Lambda, with cloudfront events. We iterate on that to use the Serverless Framework. . TLDR; Have a look at the companion repo.. It contains an example dockerized web app and the shell scripts for starting containers and creating the service. . This article covers how to automate with a Digital Ocean droplet so to follow along with the code, you can create one using the example from a previous article. . We will examine the cURL statements, convert those into Python. We can use AWS Lambda to execute the Python in a serverless environment. Then, the AWS lambda functions can be triggered by Cloudwatch events to a schedule so machines can be brought online only during operating hours. . We can notify any interested parties using Microsoft Teams - a topic for a subsequent post. . Prerequisites . You can always check the companion repo. . You will need to: . .. have jq installed to format JSON responses Download JQ for your OS | . | . .. have a server on which a dockerized web app will start automatically when the server is restarted See previous article on how to create one with DigitalOcean. | . | . .. have installed Boto3 with your AWS account credentials so we can work with the AWS Python SDK. | . cURL statements to boot down and up . As covered in a previous post, our web app will restart when rebooted using a systemd service. . Rather than ssh or the cloud provider&#39;s control panel, the server can be started and stopped using cURL. . In the case of DigitalOcean: . Find out the ID of the server: . $ curl -H &#39;Content-Type: application/json&#39; -H &#39;Authorization: Bearer &#39;$DIGITAL_OCEAN_ACCESS_TOKEN&#39;&#39; &quot;https://api.digitalocean.com/v2/droplets?name=scheduled-serverless&quot; | jq &#39;.droplets[] | {id:.id, name:.name, status: .status}&#39; . The output gives us the ID . { ... }, { &quot;id&quot;: 195786885, &quot;name&quot;: &quot;scheduled-serverless&quot;, &quot;status&quot;: &quot;active&quot; } . And then power it down: . $ curl -X POST -H &#39;Content-Type: application/json&#39; -H &#39;Authorization: Bearer &#39;$DIGITAL_OCEAN_ACCESS_TOKEN&#39;&#39; -d &#39;{&quot;type&quot;:&quot;power_off&quot;}&#39; &quot;https://api.digitalocean.com/v2/droplets/195786885/actions&quot; | jq &#39;.[] | {id:.id, status:.status, type:.type}&#39; . Which tells us it&#39;s in progress . { &quot;id&quot;: 955320153, &quot;status&quot;: &quot;in-progress&quot;, &quot;type&quot;: &quot;power_off&quot; } . The equivalent cURL for powering on the server is virtual identical . $ curl -X POST -H &#39;Content-Type: application/json&#39; -H &#39;Authorization: Bearer &#39;$DIGITAL_OCEAN_ACCESS_TOKEN&#39;&#39; -d &#39;{&quot;type&quot;:&quot;power_on&quot;}&#39; &quot;https://api.digitalocean.com/v2/droplets/195786885/actions&quot; | jq &#39;.[] | {id:.id, status:.status, type:.type}&#39; . The web app from the example is running on port 80. We know the server&#39;s IP address by referring to the control panel. Let&#39;s confirm that the service is running by verifying the output in a browser. . . Requests scripts in AWS Lambda . The cURL statements in Python . First, get the ID of the droplet. . import os import sys import requests TOKEN = os.getenv(&#39;DIGITAL_OCEAN_ACCESS_TOKEN&#39;,&#39;&#39;) DROPLET_NAME = &#39;scheduled-serverless&#39; headers = { &#39;Content-Type&#39;: &#39;application/json&#39;, &#39;Authorization&#39;: f&#39;Bearer {TOKEN}&#39;, } if TOKEN == &#39;&#39;: sys.exit(&#39;Your environment should have the `DIGITAL_OCEAN_ACCESS_TOKEN exported.&#39;) def get_droplet(): response = requests.get(&#39;https://api.digitalocean.com/v2/droplets&#39;, headers=headers, params={}) return [d for d in response.json().get(&#39;droplets&#39;,{}) if d.get(&#39;name&#39;,&#39;&#39;) == DROPLET_NAME][0] DROPLET = get_droplet() print(f&#39;Droplet ID: {DROPLET.get(&quot;id&quot;)}&#39;) . Droplet ID: 195786885 . Now we have the ID, let&#39;s define the functions for bringing the servers down and back up. . def power_off() -&gt; dict: data = &#39;{&quot;type&quot;:&quot;power_off&quot;}&#39; url = f&#39;https://api.digitalocean.com/v2/droplets/{DROPLET.get(&quot;id&quot;)}/actions&#39; response = requests.post(url, headers=headers, data=data) return response.json() def power_on() -&gt; dict: data = &#39;{&quot;type&quot;:&quot;power_on&quot;}&#39; url = f&#39;https://api.digitalocean.com/v2/droplets/{DROPLET.get(&quot;id&quot;)}/actions&#39; response = requests.post(url, headers=headers, data=data) return response.json() action_resp = power_off() print(action_resp[&#39;action&#39;][&#39;type&#39;]) print(action_resp[&#39;action&#39;][&#39;status&#39;]) print(&#39;-&#39;) # action_resp = power_on() # print(action_resp[&#39;action&#39;][&#39;type&#39;]) # print(action_resp[&#39;action&#39;][&#39;status&#39;]) . power_off in-progress - . Running the scripts in AWS Lambda . Let&#39;s translate the cURL statements into Python. . Schedule the scripts with Cloudwatch events . Serverless framework . Quality of Life enhancements . When the target service is unavailable, it&#39;s quite unfriendly to show a blank 500 screen. A subsequent post outlines a solution for a forwarding service which can display an Open/Closed for business page to the user, with &#39;Opening times&#39; . As part of what&#39;s become known as &#39;Chatops&#39;, it&#39;s useful to update team members and stakeholders about the status of the server. A future addition will be to use the Microsoft Teams API to notify interested parties. . Resources . Curl converter - [github] . convert curl commands to Python, JavaScript, PHP, R, Go, Rust, Dart, JSON, Ansible, Elixir . | .",
            "url": "https://words.howapped.com/aws%20lambda/automation/python/2020/06/11/scheduled-serverless-startup.html",
            "relUrl": "/aws%20lambda/automation/python/2020/06/11/scheduled-serverless-startup.html",
            "date": " â€¢ Jun 11, 2020"
        }
        
    
  
    
        ,"post11": {
            "title": "Automatically restart docker containers after reboot",
            "content": "The Problem . As part of Covid-19 relief, DigitalOcean donated some free credit for me to work on a local food delivery scheme. . I need to get most value for money by making that credit go as far as possible. It would also be nice to minimise power consumption. . The Solution . The server should be powered-down outside of operating hours and turned back on before start of business. This can be done using the cloud provider&#39;s control panel. . To avoid manual work starting the web app, a service is needed to bring the containers back online when the droplet is swtiched on. . Covered in this article is the process for using the DigitalOcean API to create a droplet with the requisite user_data for creating the systemd service to start containers at boot time. . TLDR; Have a look at the companion repo.. It contains an example dockerized web app and the shell scripts for starting containers and creating the service. . Not covered in this article is the process to automate the power down and up to a schedule. This is covered in a subsequent article. . Prerequisites . A Digital Ocean account (free trial available) | Generate an access token for accessing the DigitalOcean API | Add the token to your environment . $ export DIGITAL_OCEAN_ACCESS_TOKEN=XXXXXXXX . | jq installed to format JSON responses Download JQ for your OS | . | . Create a DigitalOcean droplet (optional) . If you already have a web server, with an app, move to section, &#39;Create a systemd service.&#39; . If you do not already have a web server, launch a Droplet with requisite SSH access. . cURL to create the droplet . This cURL statement creates an Ubuntu 18.04 server in London. The user_data key in the payload is used for defining various statements to execute once the server is created. In this case we are cloning the repo containing the dockerized app, starting it, and creating the systemd service to restart the app when the server boots up. . $ curl -X POST -H &#39;Content-Type: application/json&#39; -H &#39;Authorization: Bearer &#39;$DIGITAL_OCEAN_ACCESS_TOKEN&#39;&#39; -d &#39;{&quot;name&quot;:&quot;scheduled-serverless&quot;,&quot;region&quot;:&quot;lon1&quot;,&quot;size&quot;:&quot;s-2vcpu-4gb&quot;,&quot;image&quot;:&quot;docker-18-04&quot;, &quot;user_data&quot;: &quot;#!/bin/bash apt-get update apt-get upgrade -y git clone https://github.com/jonwhittlestone/scheduled-serverless-startup.git /root/scheduled-serverless-startup sh /root/scheduled-serverless-startup/start-containers.sh sh /root/scheduled-serverless-startup/create-service.sh&quot;}&#39; &quot;https://api.digitalocean.com/v2/droplets&quot; . SSH into your new droplet . You will be emailed your root password. After you SSH in using the provided password, you will be asked to change it. . . Test the web app is running . The app is running with Docker on port 80, so it&#39;s simply a case of: . root@scheduled-serverless:~# curl localhost A Howapped Project. . Test the service is running . Restart your server with . root@scheduled-serverless:~# sudo reboot . And then ssh and repeat the cURL statement to the web service . (base) âœ ~ ssh root@167.172.56.239 curl localhost root@167.172.56.239&#39;s password: % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 0 0 0 0 0 0 0 0 --:--:-- --:--:-- --:--:-- 0 A Howapped Project. 100 22 100 22 0 0 1294 0 --:--:-- --:--:-- --:--:-- 1294 . Create a systemd service . Ubuntu&#39;s init system is called systemd and various flavours of Linux may have differing init systems. . Scripting the starting of the web app . We need to define what should be automated which is starting the containers. . In this case, I have an example dockerized app defined in the companion repo, so let&#39;s clone that. . If this directory is present (because it has been previously cloned), then just pull the latest changes. . #!/bin/bash if [ -d &quot;/root/scheduled-serverless-startup&quot; ] then git pull origin master else cd /root/scheduled-serverless-startup git clone https://github.com/jonwhittlestone/scheduled-serverless-startup.git /root/scheduled-serverless-startup fi cd /root/scheduled-serverless-startup/app docker-compose up -d . Lastly, we start containers with docker-compose . Using systemctl to enable the service . Using the interface systemctl we can manage the init system. Each service is called a unit file. This means loading a service, enabling at boot and restarting. . On an Ubuntu system, you may inspect the running services: . $ systemctl status | head â— madebyjon State: running Jobs: 0 queued Failed: 0 units Since: Mon 2020-06-08 05:56:42 BST; 1 day 2h ago CGroup: / â”œâ”€3770 bpfilter_umh â”œâ”€user.slice â”‚ â””â”€user-1000.slice â”‚ â”œâ”€user@1000.service . The following shell script creates the unit file, enables it at boot and starts the service. . #!/bin/bash touch /etc/systemd/system/howapped.service cat &gt; /etc/systemd/system/howapped.service&lt;&lt;-EOF [Unit] Description=HowappedProjectStartOnBoot After=network.target [Service] Type=simple User=root WorkingDirectory=/root/scheduled-serverless-startup ExecStart=/bin/sh /root/scheduled-serverless-startup/start-containers.sh Restart=on-abort [Install] WantedBy=multi-user.target EOF systemctl daemon-reload systemctl enable howapped.service systemctl restart howapped.service . Enable the systemd service . The below excerpt verifies we have the working directory created. . root@scheduled-serverless:~/scheduled-serverless-startup# ls README.md app create-service.sh Vagrantfile cloud-config.yaml start-containers.sh root@scheduled-serverless:~/scheduled-serverless-startup# pwd /root/scheduled-serverless-startup . And this runs the shell script to create the unit file and enable it. . root@scheduled-serverless:~/scheduled-serverless-startup# sh create-service.sh Created symlink /etc/systemd/system/multi-user.target.wants/howapped.service â†’ /etc/systemd/system/howapped.service. . Test it . We will use the CURL statement to find the ID of our droplet, so that we can then use a CURL statement to power down the machine. . $ curl -H &#39;Content-Type: application/json&#39; -H &#39;Authorization: Bearer &#39;$DIGITAL_OCEAN_ACCESS_TOKEN&#39;&#39; &quot;https://api.digitalocean.com/v2/droplets?name=scheduled-serverless&quot; | jq &#39;.droplets[] | {id:.id, name:.name, status: .status}&#39; { &quot;id&quot;: 195393249, &quot;name&quot;: &quot;scheduled-serverless&quot;, &quot;status&quot;: &quot;on&quot; } # power it down $ curl -X POST -H &#39;Content-Type: application/json&#39; -H &#39;Authorization: Bearer &#39;$DIGITAL_OCEAN_ACCESS_TOKEN&#39;&#39; -d &#39;{&quot;type&quot;:&quot;power_off&quot;}&#39; &quot;https://api.digitalocean.com/v2/droplets/195393249/actions&quot; | jq &#39;.[] | {id:.id, status:.status, type:.type}&#39; . We power it back up: . $ curl -X POST -H &#39;Content-Type: application/json&#39; -H &#39;Authorization: Bearer &#39;$DIGITAL_OCEAN_ACCESS_TOKEN&#39;&#39; -d &#39;{&quot;type&quot;:&quot;power_on&quot;}&#39; &quot;https://api.digitalocean.com/v2/droplets/195393249/actions&quot; | jq &#39;.[] | {id:.id, status:.status, type:.type}&#39; { &quot;id&quot;: 953153688, &quot;status&quot;: &quot;in-progress&quot;, &quot;type&quot;: &quot;power_on&quot; } . And verify our app is running. . $ ssh root@104.248.174.117 curl localhost root@104.248.174.117&#39;s password: % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 0 0 0 0 0 0 0 0 --:--:-- --:--:-- --:--:-- 0 A Howapped Project. . Clean up . If you were following along by creating a DigitalOcean droplet, you may wish to power down or destroy the machine if not in use. . . Resources . Linode - Introduction to Systemctl | .",
            "url": "https://words.howapped.com/systemd/automation/2020/06/01/automatically-restart-docker-after-reboot-with-service.html",
            "relUrl": "/systemd/automation/2020/06/01/automatically-restart-docker-after-reboot-with-service.html",
            "date": " â€¢ Jun 1, 2020"
        }
        
    
  

  
  

  
      ,"page1": {
          "title": "Contact",
          "content": "Howapped is a software consultancy from UK run by me, Jon. . Hello ğŸ¤“ . howapped words covers project updates and my learnings from the Howapped labs 1. . Iâ€™m an end-to-end product engineer and help SaaS companies retain larger, more valuable subscribers. . Please contact for project or mentorship opportunities words@howapped.com . This website is powered by fastpages . not really a lab with test tubes and stuff.Â &#8617; . |",
          "url": "https://words.howapped.com/contact/",
          "relUrl": "/contact/",
          "date": ""
      }
      
  

  

  
  

  

  
  

  

  
  

  
  

  
  

  
      ,"page10": {
          "title": "",
          "content": "Sitemap: {{ â€œsitemap.xmlâ€ | absolute_url }} | .",
          "url": "https://words.howapped.com/robots.txt",
          "relUrl": "/robots.txt",
          "date": ""
      }
      
  

}